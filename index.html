<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 
    <title>Editor Mobile SeBaS v7.2</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        :root { 
            --primary: #8B5E3C; --bg: #F3F4F6; --sidebar: #1F2937; --text: #1f2937;
            --text-light: #6b7280; --green: #10B981; --blue: #2563EB; --orange: #f97316; --danger: #EF4444;
            --gold: #F59E0B;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); display: flex; flex-direction: column; height: 100vh; margin: 0; overflow: hidden; color: var(--text); font-size: 14px; }
        
        /* LOGIN SCREEN */
        #login-screen { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #111827; z-index: 9999; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            color: white; transition: 0.3s;
            padding-bottom: 20vh;
        }
        .login-box { width: 85%; max-width: 280px; text-align: center; }
        .login-avatar { width: 70px; height: 70px; background: var(--gold); border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; box-shadow: 0 0 20px rgba(245, 158, 11, 0.5); }
        .pass-wrapper { position: relative; width: 100%; margin-bottom: 15px; }
        
        .login-input { 
            background: #374151 !important; border: 1px solid #4b5563; color: white !important; 
            padding: 12px 40px 12px 15px; border-radius: 10px; width: 100%; font-size: 1.1rem; 
            text-align: center; letter-spacing: 3px; outline: none; -webkit-text-fill-color: white !important; 
        }
        .login-input:focus { border-color: var(--gold); }
        
        .toggle-eye { 
            position: absolute; right: 10px; top: 42%; transform: translateY(-50%); 
            cursor: pointer; font-size: 1.3rem; z-index: 10; padding: 5px; color: var(--gold);
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); user-select: none;
        }
        .toggle-eye:hover { transform: translateY(-50%) scale(1.2); filter: drop-shadow(0 0 5px rgba(245, 158, 11, 0.5)); }
        .eye-pop { animation: eyePopAnim 0.4s ease; }
        @keyframes eyePopAnim { 0% { transform: translateY(-50%) scale(1); } 50% { transform: translateY(-50%) scale(0.5) rotate(10deg); } 100% { transform: translateY(-50%) scale(1) rotate(0deg); } }
        
        .btn-login { background: var(--gold); color: #000; border: none; padding: 12px; width: 100%; border-radius: 10px; font-weight: bold; font-size: 0.95rem; cursor: pointer; box-shadow: 0 4px 10px rgba(245, 158, 11, 0.3); }

        /* HEADER & NAV */
        .mobile-header { background: var(--sidebar); padding: 8px 0; flex-shrink: 0; z-index: 100; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .nav-scroller { display: flex; overflow-x: auto; gap: 8px; padding: 0 10px; scrollbar-width: none; -webkit-overflow-scrolling: touch; }
        .nav-pill { white-space: nowrap; padding: 6px 14px; border-radius: 18px; font-size: 0.8rem; color: #d1d5db; background: rgba(255,255,255,0.1); transition: 0.2s; cursor: pointer; border: 1px solid transparent; }
        .nav-pill.active { background: var(--primary); color: white; border-color: rgba(255,255,255,0.3); font-weight: 600; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }

        main { flex: 1; padding: 15px 10px 130px 10px; overflow-y: auto; position: relative; scroll-behavior: smooth; }
        .panel { display: none; width: 100%; animation: fadeIn 0.3s ease; }
        .panel.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* CARDS & INPUTS */
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 1px 4px rgba(0,0,0,0.05); margin-bottom: 10px; border: 1px solid #e5e7eb; }
        h1 { margin-top: 0; font-size: 1.4rem; margin-bottom: 12px; font-weight: 800; color: #111827; display: flex; align-items: center; justify-content: space-between; }
        .btn-icon-small { background: #f3f4f6; border: none; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; cursor: pointer; color: #374151; }
        label { display: block; margin-bottom: 4px; font-weight: 600; font-size: 0.8rem; color: #374151; }
        input:not([type="checkbox"]):not([type="range"]), textarea, select { width: 100%; padding: 8px 10px; margin-bottom: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 0.9rem; background: #fff; font-family: inherit; -webkit-appearance: none; color: #1f2937; }
        .row { display: flex; gap: 8px; } .col { flex: 1; }
        
        /* BOTTOM TOOLBAR */
        .fab-container { position: fixed; bottom: 0; left: 0; right: 0; display: grid; grid-template-columns: repeat(5, 1fr); gap: 2px; z-index: 1000; padding: 5px; background: white; border-top: 1px solid #e5e7eb; box-shadow: 0 -4px 15px rgba(0,0,0,0.05); }
        .fab-btn { border: none; border-radius: 8px; padding: 4px; color: white; font-weight: 600; font-size: 0.6rem; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 2px; height: 48px; width: 100%; }
        .fab-icon { font-size: 1.1rem; line-height: 1; }
        .fab-draft { background-color: var(--blue); } 
        .fab-backup { background-color: #8b5cf6; } 
        .fab-restore { background-color: var(--orange); } 
        .fab-download { background-color: var(--green); }
        .fab-publish { background-color: #111827; }

        /* PRODUCT GRID */
        .prod-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 10px; }
        @media(max-width: 350px) { .prod-grid { grid-template-columns: repeat(2, 1fr); } }
        .prod-card { background: white; border: 1px solid #e5e7eb; border-radius: 10px; padding: 8px; display: flex; flex-direction: column; box-shadow: 0 2px 4px rgba(0,0,0,0.02); position: relative; padding-bottom: 8px; }
        .prod-img { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 6px; background: #f3f4f6; margin-bottom: 6px; pointer-events: none; }
        .prod-title { font-weight: 700; font-size: 0.8rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin-bottom: 2px; }
        .prod-meta { font-size: 0.65rem; color: #666; display: flex; justify-content: space-between; margin-bottom: 8px; }
        .prod-actions { display: flex; gap: 6px; margin-top: auto; flex-wrap: wrap; }
        .btn-card { flex: 1; padding: 8px 0; border-radius: 6px; border: none; font-size: 0.7rem; font-weight: 700; cursor: pointer; display:flex; align-items:center; justify-content:center;}
        .btn-card-edit { background: #eff6ff; color: var(--blue); flex-basis: 40%; } 
        .btn-card-del { background: #fef2f2; color: var(--danger); flex-basis: 30%; }
        .btn-card-tool { background: #f3f4f6; color: #374151; font-size: 0.8rem; padding: 6px; flex-basis: 20%; }
        
        .stock-badge-editor { position: absolute; top: 4px; right: 4px; background: rgba(0,0,0,0.8); color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.55rem; font-weight: bold; }

        /* MODAL */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 5000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(2px); }
        .modal-overlay.open { display: flex; }
        #pass-modal .modal-content { height: auto; max-height: 50vh; border-radius: 16px; width: 85%; max-width: 300px; animation: popIn 0.3s; padding: 15px; background: white; }
        .modal-content-full { background: #fff; width: 100%; height: 100%; display: flex; flex-direction: column; overflow: hidden; animation: slideUp 0.3s; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .modal-header { display: flex; justify-content: space-between; padding: 10px 15px; border-bottom: 1px solid #f3f4f6; background: #fff; align-items: center; height: 50px; }
        .modal-body-grid { flex: 1; display: flex; flex-direction: column; overflow-y: auto; padding: 15px; padding-bottom: 80px; }
        .prize-row, .extra-img-row { display: flex; gap: 5px; align-items: center; margin-bottom: 8px; width: 100%; }
        .prize-row input, .extra-img-row input { margin-bottom: 0 !important; flex: 1; }
        .prize-row button, .extra-img-row button { width: 36px; height: 36px; border-radius: 6px; background: #fee2e2; color: #ef4444; border: none; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; flex-shrink: 0; cursor: pointer; }
        #prod-desc { min-height: 120px; font-family: monospace; line-height: 1.4; resize: vertical; }
        .checkbox-wrapper { display: flex; align-items: center; justify-content: space-between; padding: 10px; background: #f9fafb; border-radius: 10px; border: 1px solid #e5e7eb; margin-bottom: 8px; }
        .checkbox-wrapper input[type="checkbox"] { width: 20px; height: 20px; margin: 0; accent-color: var(--blue); }
        .checkbox-wrapper label { margin: 0; flex: 1; margin-left: 10px; font-weight: 600; font-size: 0.85rem; }

        .btn-save-modal { width: 100%; padding: 12px; background: var(--green); color: white; border: none; border-radius: 10px; font-weight: 800; font-size: 0.95rem; cursor: pointer; margin-top: 15px; box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3); text-transform: uppercase; letter-spacing: 1px; }
        .upload-zone { border: 2px dashed #d1d5db; padding: 20px; text-align: center; border-radius: 12px; background: #f9fafb; cursor: pointer; transition: 0.2s; }
        .upload-zone:active { background: #e5e7eb; border-color: var(--blue); }
        
        /* OPTIMIZER */
        .opt-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; margin-top: 15px; }
        .opt-card { background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; padding: 4px; text-align: center; position: relative;}
        .opt-card img { width: 100%; border-radius: 6px; aspect-ratio: 1; object-fit: cover; margin-bottom: 4px; }
        .btn-opt-single { background: #f0fdf4; border: 1px solid var(--green); color: #059669; width: 100%; padding: 4px; border-radius: 6px; cursor: pointer; font-size: 0.7rem; font-weight: 600; }
        .btn-del-opt { position: absolute; top: -5px; right: -5px; background: var(--danger); color: white; border: none; border-radius: 50%; width: 20px; height: 20px; font-weight: bold; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2); font-size: 0.8rem; }
        .quality-control { background:white; border:1px solid #ddd; padding:10px; border-radius:8px; margin-top:10px; }

        .btn-add-cat { background-color: var(--blue); color: white; padding: 0 12px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; height: 38px; }
        .cat-chip { background: #fff; border: 1px solid #e5e7eb; padding: 6px 12px; border-radius: 16px; display: inline-flex; margin: 3px; align-items: center; gap: 6px; font-weight: 600; font-size: 0.8rem; color: #374151; }
        .cat-btn-action { border:none; background:transparent; cursor:pointer; padding:2px; display:flex; align-items:center; border-radius:4px; font-size: 0.8rem; }
        
        .editor-raffle-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(35px, 1fr)); gap: 6px; max-height: 200px; overflow-y: auto; padding: 8px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 12px; background: #f9fafb; }
        .editor-num-box { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; background: white; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 0.8rem; user-select: none; color: #374151; }
        .editor-num-box.is-sold { background: #fee2e2; color: #ef4444; border-color: #fca5a5; position: relative; }
        .editor-num-box.is-sold::after { content:'X'; font-size: 1.1rem; position: absolute; color: rgba(239,68,68,0.3); }

        .raffle-toggle-container {
            display: flex; justify-content: space-between; align-items: center;
            background: #fffbeb; border: 1px solid #fcd34d; padding: 12px;
            border-radius: 10px; margin-bottom: 15px; cursor: pointer;
        }
    </style>
</head>
<body>

    <!-- LOGIN -->
    <div id="login-screen">
        <div class="login-box">
            <div class="login-avatar">üë®‚Äçüíª</div>
            <h2 style="margin-bottom:5px;">Hola, SeBaS</h2>
            <p style="color:#9ca3af; margin-bottom:20px; font-size:0.8rem;">Ingresa tu clave</p>
            <div class="pass-wrapper">
                <input type="password" id="login-pass" class="login-input" placeholder="Clave" inputmode="numeric">
                <span class="toggle-eye" onclick="togglePass('login-pass', this)">üëÅÔ∏è</span>
            </div>
            <button class="btn-login" onclick="checkLogin()">ENTRAR</button>
        </div>
    </div>

    <div class="mobile-header">
        <div class="nav-scroller">
            <div class="nav-pill active" onclick="switchPanel(0)">üè† Inicio</div>
            <div class="nav-pill" onclick="switchPanel(1)">‚öôÔ∏è Config</div>
            <div class="nav-pill" onclick="switchPanel(2)">üìÇ Categor√≠as</div>
            <div class="nav-pill" onclick="switchPanel(3)">üì¶ Art√≠culos</div>
            <div class="nav-pill" onclick="switchPanel(4)">üì∏ Optimizador</div>
            <div class="nav-pill" style="color:#FCD34D" onclick="switchPanel(5)">üéâ Sorteos</div>
        </div>
    </div>

    <main id="main-content">
        <!-- Input oculto para restaurar -->
        <input type="file" id="restoreInput" accept=".json" style="display:none" onchange="importBackup(this)">
        
        <!-- PANEL 0: INICIO -->
        <div id="panel-0" class="panel">
            <h1>Hola, SeBaS üëã</h1>
            
            <div id="draft-alert" class="card" style="display:none; background: #fffbeb; border: 1px solid #fcd34d;">
                <h4 style="margin:0 0 8px; color: #b45309; font-size:0.9rem;">‚ö†Ô∏è Hay cambios sin guardar</h4>
                <p style="font-size:0.8rem; color:#b45309; margin-bottom:10px;">Tienes un borrador guardado en la memoria del navegador.</p>
                <div style="display:flex; gap:8px;">
                    <button class="btn-add-cat" style="background:#b45309; height:32px; font-size:0.8rem; flex:1;" onclick="loadDraft()">Recuperar Borrador</button>
                    <button class="btn-add-cat" style="background:transparent; color:#b45309; border:1px solid #b45309; height:32px; font-size:0.8rem;" onclick="clearDraft()">Descartar</button>
                </div>
            </div>

            <div class="card" style="background: white; border-left: 5px solid var(--primary);">
                <h3 style="margin-top:0; color: var(--primary);">üìä Estado Actual</h3>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; text-align:center;">
                    <div style="background:#f3f4f6; padding:10px; border-radius:8px;">
                        <span style="display:block; font-size:1.5rem; font-weight:800;" id="stat-prod-count">0</span>
                        <span style="font-size:0.75rem; color:#666;">Productos</span>
                    </div>
                    <div style="background:#f3f4f6; padding:10px; border-radius:8px; display:flex; flex-direction:column; justify-content:center;">
                        <span style="display:block; font-size:1rem; margin-bottom:4px;" id="stat-raffle-status">‚ö™</span>
                        <div id="stat-raffle-info" style="font-size:0.75rem; line-height:1.2;"></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-top:0; font-size:1rem;">üìÇ Gesti√≥n de Proyecto</h3>
                <div class="upload-zone" onclick="document.getElementById('fileInput').click()" style="padding: 15px; border-color: var(--blue);">
                    <h3 style="margin:0; font-size:0.9rem; color:var(--blue);">üì• Importar Web (HTML)</h3>
                    <p style="margin:5px 0 0; color:#666; font-size:0.75rem;">Si ya tienes tu index.html, c√°rgalo aqu√≠ para editarlo.</p>
                    <input type="file" id="fileInput" accept=".html" style="display:none" onchange="loadFile(this)">
                </div>
                <p id="status" style="margin-top: 5px; color: var(--green); text-align: center; font-weight: 700; min-height: 18px; font-size:0.8rem;"></p>
                
                <details style="margin-top:15px; border-top:1px solid #eee; padding-top:10px;">
                    <summary style="font-size:0.8rem; color:#666; cursor:pointer; font-weight:600;">üõ†Ô∏è Opciones Avanzadas (Dise√±o)</summary>
                    <p style="font-size:0.75rem; color:#888; margin-top:5px;">Usa esto solo si modificaste el c√≥digo fuente de la plantilla base y quieres actualizar el "motor" del editor.</p>
                    <button class="btn-opt-single" style="width:100%; height:35px; background: #f3f4f6; color:#444; border:1px solid #ddd;" onclick="document.getElementById('templateInput').click()">Actualizar Plantilla Base</button>
                    <input type="file" id="templateInput" accept=".html" style="display:none" onchange="updateTemplateBase(this)">
                </details>
            </div>
        </div>

        <!-- PANEL 1: CONFIG -->
        <div id="panel-1" class="panel">
            <h1>Configuraci√≥n <button class="btn-icon-small" onclick="openPassModal()">üîí</button></h1>
            
            <div class="card">
                <label>Nombre Tienda</label><input type="text" id="cfg-name">
                <label>WhatsApp (Sin 0 ni 15)</label><input type="tel" id="cfg-whatsapp">
                <label>Logo URL</label><input type="text" id="cfg-logo">
                <label>T√≠tulo Banner</label><input type="text" id="cfg-heroTitle">
                <label>Subt√≠tulo Banner</label><input type="text" id="cfg-heroSubtitle">
                <label>Imagen Fondo Banner</label><input type="text" id="cfg-heroImage">
                <label>Texto Footer</label><textarea id="cfg-aboutText" style="height:80px;"></textarea>
            </div>
            <div class="card" style="border: 1px solid #3b82f6; background: #eff6ff;">
                <h3 style="margin-top:0; color: #1e40af; font-size:1rem; margin-bottom:10px;">‚òÅÔ∏è GitHub API</h3>
                <label>Usuario</label><input type="text" id="gh-user">
                <label>Repo</label><input type="text" id="gh-repo">
                <label>Token</label><input type="password" id="gh-token">
                <label>Carpeta (ej: img)</label><input type="text" id="gh-folder">
                <button class="btn-add-cat" style="width:100%; background:#2563EB;" onclick="saveGitHubCreds()">üíæ Guardar API</button>
            </div>
        </div>

        <!-- PANEL 2: CATEGORIAS -->
        <div id="panel-2" class="panel">
            <h1>Categor√≠as</h1>
            <div class="card">
                <div class="row">
                    <div class="col"><input type="text" id="new-cat" placeholder="Nueva categor√≠a..."></div>
                    <div style="width: auto;"><button class="btn-add-cat" onclick="addCategory()">+</button></div>
                </div>
                <div id="cat-list" style="margin-top:15px; display:flex; flex-wrap:wrap;"></div>
            </div>
        </div>

        <!-- PANEL 3: ARTICULOS -->
        <div id="panel-3" class="panel">
            <h1>Art√≠culos</h1>
            <div style="display:flex;gap:8px;margin-bottom:10px;background:white;padding:8px;border-radius:10px;border:1px solid #e5e7eb; box-shadow:0 1px 3px rgba(0,0,0,0.05);">
                <input type="text" id="prod-search" placeholder="üîç Buscar..." style="margin:0;flex:2;border:none;padding:0;outline:none;font-size:0.9rem;" oninput="renderProdList()">
                <div style="width:1px;background:#eee;"></div>
                <select id="prod-filter-cat" style="margin:0;flex:1;border:none;padding:0;outline:none;background:transparent;font-size:0.8rem;" onchange="renderProdList()">
                    <option value="all">Todo</option>
                </select>
            </div>
            <button class="btn-opt-single" style="width:100%; height:45px; font-size:0.9rem; margin-bottom:15px; border:2px dashed #ccc; color:var(--primary); font-weight:800; background:#fff;" onclick="openProductModal()">+ AGREGAR ART√çCULO</button>
            <div id="prod-list" class="prod-grid"></div>
        </div>

        <!-- PANEL 4: OPTIMIZADOR -->
        <div id="panel-4" class="panel">
            <h1>Optimizador</h1>
            <div class="card">
                <div class="quality-control">
                    <label style="display:flex;justify-content:space-between;"><span>Calidad WebP</span><span id="qual-val" style="color:var(--blue)">85%</span></label>
                    <input type="range" id="opt-quality" min="10" max="100" value="85" style="width:100%;" oninput="document.getElementById('qual-val').innerText=this.value+'%'">
                </div>
                <div class="upload-zone" onclick="document.getElementById('opt-input').click()" style="margin-top:10px;">
                    <h3 style="font-size:1rem;margin-bottom:5px;">üì∏ Subir Fotos</h3>
                    <p style="margin:0;color:#999;font-size:0.75rem;">Selecciona m√∫ltiples im√°genes</p>
                    <input type="file" id="opt-input" multiple accept="image/*" style="display:none" onchange="procesarImagenes()">
                </div>
                <div style="display:flex; gap: 8px; margin-top:15px;">
                     <a href="https://banana.ovo.re/" target="_blank" class="btn-add-cat" style="background:#8b5cf6; flex:1; text-align:center; text-decoration:none; display:flex; align-items:center; justify-content:center; font-size:0.8rem;">‚ú® IA Remove</a>
                     <button class="btn-add-cat" style="background:#2563EB; flex:1; font-size:0.8rem;" onclick="batchUpload()">‚òÅÔ∏è Subir Todo</button>
                </div>
                <div id="opt-grid" class="opt-grid"></div>
            </div>
        </div>

        <!-- PANEL 5: SORTEOS -->
        <div id="panel-5" class="panel">
            <h1>Sorteos</h1>
            <div class="raffle-toggle-container" onclick="toggleRaffleCheck()">
                <span style="font-weight:800; color:#b45309; font-size:0.85rem;">ESTADO DEL SORTEO</span>
                <div style="display:flex;align-items:center;gap:8px;">
                    <span id="raffle-status-text" style="font-weight:bold; font-size:0.85rem; color:#b45309;">INACTIVO</span>
                    <input type="checkbox" id="raffle-active" style="width:20px;height:20px;margin:0;pointer-events:none;"> 
                </div>
            </div>
            <div class="card">
                <label>T√≠tulo</label><input type="text" id="raffle-title">
                <label>Imagen URL</label><input type="text" id="raffle-img">
                <div class="row">
                     <div class="col"><label>Precio $</label><input type="number" id="raffle-price"></div>
                     <div class="col"><label>Total N√∫meros</label><input type="number" id="raffle-total" onchange="renderEditorRaffleGrid()"></div>
                </div>
                <label>WhatsApp (Opcional)</label><input type="tel" id="raffle-whatsapp">
                
                <label style="color:var(--primary);font-weight:bold;margin-top:15px;">Marcar Vendidos</label>
                <div id="editor-raffle-grid" class="editor-raffle-grid"></div>

                <label>Premios</label>
                <div id="prizes-container"></div>
                <button class="btn-opt-single" style="margin-bottom:15px; padding:10px; width:100%; border:1px dashed #d97706; background:#fffbeb; color:#d97706; font-weight:700; font-size:0.85rem;" onclick="addPrizeRow()">+ AGREGAR PREMIO</button>
                
                <button class="btn-save-modal" style="background:var(--gold); color:black; margin-top:8px;" onclick="saveRaffle()">üíæ GUARDAR SORTEO</button>
            </div>
        </div>
    </main>

    <!-- BOTTOM BAR FIXED -->
    <div class="fab-container">
        <button class="fab-btn fab-draft" onclick="saveToBrowser()">
            <span class="fab-icon">üíæ</span> Borrador
        </button>
        <button class="fab-btn fab-backup" onclick="exportBackup()">
            <span class="fab-icon">üì§</span> Backup
        </button>
        <button class="fab-btn fab-restore" onclick="triggerRestore()">
            <span class="fab-icon">üì•</span> Restaurar
        </button>
        <button class="fab-btn fab-download" onclick="downloadSite()">
            <span class="fab-icon">üì¶</span> HTML
        </button>
        <button class="fab-btn fab-publish" onclick="publishToGithub()">
            <span class="fab-icon">üöÄ</span> Web
        </button>
    </div>

    <!-- MODAL PRODUCTO -->
    <div class="modal-overlay" id="product-modal">
        <div class="modal-content-full">
            <div class="modal-header">
                <h3 style="margin:0; font-size:1.1rem;">Detalles Producto</h3>
                <button style="border:none;background:none;font-size:2rem;padding:0 10px; color:#666;" onclick="closeProductModal()">√ó</button>
            </div>
            <div class="modal-body-grid">
                <input type="hidden" id="prod-id">
                <label>Nombre del Producto</label><input type="text" id="prod-name">
                <div class="row">
                    <div class="col"><label>Categor√≠a</label><select id="prod-cat"></select></div>
                    <div class="col"><label>Precio</label><input type="number" id="prod-price"></div>
                </div>
                <label>Medidas</label><input type="text" id="prod-dims">
                <label>Foto Principal (URL)</label><input type="text" id="prod-img">
                
                <div class="checkbox-wrapper">
                    <label for="prod-featured">‚≠ê Destacar en Inicio</label>
                    <input type="checkbox" id="prod-featured">
                </div>
                <div class="checkbox-wrapper">
                    <label for="prod-nostock" style="color:#dc2626;">üö´ Marcar Sin Stock</label>
                    <input type="checkbox" id="prod-nostock">
                </div>

                <label>Galer√≠a Extra</label>
                <div id="extra-img-container"></div>
                <button type="button" class="btn-opt-single" style="margin-bottom:15px; border:1px dashed #ccc; padding:10px; width:100%; font-size:0.8rem; color:#666;" onclick="addExtraImgField()">+ Agregar Foto Extra</button>
                
                <label>Descripci√≥n</label>
                <textarea id="prod-desc" placeholder="Escribe aqu√≠..."></textarea>
                
                <button class="btn-save-modal" onclick="saveProduct()">GUARDAR CAMBIOS</button>
            </div>
        </div>
    </div>

    <!-- MODAL CAMBIAR PASSWORD -->
    <div class="modal-overlay" id="pass-modal">
        <div class="modal-content">
            <h3 style="text-align:center; margin-top:0; font-size:1.1rem;">Cambiar Clave</h3>
            <label>Nueva Contrase√±a</label>
            <input type="text" id="new-password" placeholder="M√≠nimo 4 caracteres" style="text-align:center; font-size:1.1rem;">
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button class="btn-opt-single" style="flex:1; background:#f3f4f6; color:#333; border:1px solid #ccc; height:40px;" onclick="document.getElementById('pass-modal').classList.remove('open')">Cancelar</button>
                <button class="btn-add-cat" style="flex:1; background:var(--gold); color:black;" onclick="changePassword()">Guardar</button>
            </div>
        </div>
    </div>

    <!-- TEMPLATE BASE (v7.2) - Con Paginaci√≥n -->
    <textarea id="master-template" style="display:none;">
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Muebles | Cat√°logo</title>
<meta name="description" content="Cat√°logo de muebles"><meta property="og:title" content="Muebles El Nono">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root { --primary: #8B5E3C; --secondary: #D4B483; --bg: #FDFBF7; --white: #FFFFFF; --text: #2C2C2C; --text-light: #666666; --accent: #E48F45; --radius: 12px; --shadow: 0 4px 15px rgba(139, 94, 60, 0.08); --footer-bg: #f3f4f6; --closing-bg: #FDFBF7; --closing-border: #8B5E3C; --closing-box-bg: rgba(139, 94, 60, 0.05); }
body.dark-mode { --primary: #D4B483; --secondary: #8B5E3C; --bg: #121212; --white: #1E1E1E; --text: #E0E0E0; --text-light: #AAAAAA; --shadow: 0 4px 15px rgba(0,0,0,0.5); --footer-bg: #000000; --closing-bg: #111111; --closing-border: #bcaaa4; --closing-box-bg: rgba(255,255,255,0.05); }
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif}body{background-color:var(--bg);color:var(--text);overflow-x:hidden;transition:.3s}body.modal-open{overflow:hidden}
header{padding:15px 0;background:rgba(255,255,255,0.95);backdrop-filter:blur(5px);box-shadow:var(--shadow);position:sticky;top:0;z-index:100;transition:.3s}body.dark-mode header{background:rgba(30,30,30,0.95)}
.logo{font-family:'Playfair Display',serif;font-size:1.8rem;color:var(--primary);font-weight:700;text-align:center}.logo img{max-height:80px;margin:0 auto}.container{max-width:1200px;margin:0 auto;padding:0 15px}
.hero{position:relative;height:40vh;min-height:300px;display:flex;align-items:center;justify-content:center;text-align:center;color:#fff;margin-bottom:40px;border-bottom-left-radius:30px;border-bottom-right-radius:30px;overflow:hidden}
.hero-bg{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1;filter:brightness(0.6)}.hero h1{font-family:'Playfair Display',serif;font-size:2.5rem;text-shadow:0 2px 10px rgba(0,0,0,0.5)}.btn-primary{background:var(--primary);color:#fff;padding:10px 25px;border-radius:50px;font-weight:600;text-decoration:none;display:inline-block;margin-top:15px;border:none;cursor:pointer}
.carousel-container{overflow-x:auto;display:flex;gap:20px;padding:10px 5px 20px 5px;scrollbar-width:none;scroll-behavior:smooth;scroll-snap-type:x mandatory}.featured-card{min-width:260px;height:350px;border-radius:16px;overflow:hidden;position:relative;box-shadow:var(--shadow);cursor:pointer;scroll-snap-align:center;flex-shrink:0}.featured-img{width:100%;height:100%;object-fit:cover}.featured-overlay{position:absolute;bottom:0;left:0;width:100%;background:linear-gradient(to top,rgba(0,0,0,0.9) 10%,transparent 100%);padding:20px;color:#fff;text-align:left}.featured-title{font-size:1.3rem;font-weight:600;margin-bottom:5px}.featured-detail{font-size:0.9rem;opacity:.8;font-weight:300}
.search-wrapper{max-width:500px;margin:0 auto 30px;position:relative}.search-input{width:100%;padding:12px 20px 12px 45px;border-radius:30px;border:1px solid #ddd;outline:none;background:var(--white);color:var(--text)}.search-icon{position:absolute;left:15px;top:50%;transform:translateY(-50%);width:20px;color:#999}.filters{display:flex;justify-content:center;gap:8px;flex-wrap:wrap;margin-bottom:30px}.filter-btn{padding:6px 16px;border:1px solid var(--primary);background:transparent;color:var(--primary);border-radius:30px;font-size:0.9rem;cursor:pointer;transition:.3s}.filter-btn.active,.filter-btn:hover{background:var(--primary);color:#fff}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:15px;margin-bottom:20px}.product-card{background:var(--white);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column;cursor:pointer;transition:transform .2s;position:relative}.product-card:hover{transform:translateY(-3px)}.card-img-container{height:180px;overflow:hidden}.card-img-container img{width:100%;height:100%;object-fit:cover}.card-body{padding:12px;flex-grow:1;display:flex;flex-direction:column}.card-cat{color:var(--accent);font-size:0.7rem;font-weight:600;text-transform:uppercase}.card-title{font-size:1rem;font-weight:600;margin:4px 0;color:var(--text);line-height:1.2}.card-price{margin-top:auto;font-weight:700;color:var(--primary);font-size:1.1rem}.out-of-stock{filter:grayscale(1);opacity:0.6;}.stock-badge{position:absolute;top:10px;right:10px;background:rgba(0,0,0,0.8);color:#fff;font-size:0.7rem;padding:4px 8px;border-radius:4px;z-index:20;font-weight:600}
.closing-section{padding:60px 20px;text-align:center;margin-top:50px;background:var(--closing-bg);color:var(--text);transition:.3s}.closing-box{max-width:800px;margin:0 auto;border:2px dashed var(--closing-border);border-radius:20px;padding:40px 20px;background:var(--closing-box-bg);transition:.3s}.shipping-badge{background:#E48F45;color:#fff;padding:12px 25px;border-radius:50px;font-weight:700;font-size:1rem;display:inline-block;margin-bottom:20px;box-shadow:0 4px 10px rgba(228,143,69,0.3);animation:pulse 2s infinite}@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}.closing-title{font-family:'Playfair Display',serif;font-size:1.8rem;color:var(--primary);margin-bottom:15px}.closing-text{color:var(--text-light);line-height:1.6;margin-bottom:10px;font-size:0.95rem}
footer{background:var(--footer-bg);color:var(--text);padding:50px 0;text-align:center;transition:.3s}.btn-footer-wa{background:#25D366;color:white;border:none;padding:12px 30px;border-radius:50px;font-weight:600;font-size:1rem;cursor:pointer;display:inline-flex;align-items:center;gap:8px;margin-top:15px}.theme-toggle-btn{background:transparent;border:1px solid var(--text-light);color:var(--text-light);width:40px;height:40px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;margin-top:25px;transition:.3s}.theme-toggle-btn:hover{border-color:var(--primary);color:var(--primary)}.theme-toggle-btn svg{width:20px;height:20px;fill:currentColor;transition:transform .5s ease}body.dark-mode .theme-toggle-btn svg{transform:rotate(180deg)}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:2000;display:none;align-items:center;justify-content:center;backdrop-filter:blur(5px)}.modal.open{display:flex}.modal-content{background:var(--white);width:90%;max-width:750px;height:auto;max-height:85vh;border-radius:20px;overflow:hidden;display:flex;flex-direction:column;position:relative;box-shadow:0 25px 50px -12px rgba(0,0,0,0.25)}@media(min-width:768px){.modal-content{flex-direction:row;height:500px}.modal-gallery-side{width:50%;background:#000;display:flex;align-items:center;justify-content:center}.modal-info-side{width:50%;padding:30px;overflow-y:auto;display:flex;flex-direction:column}.modal-img-main{width:100%;height:100%;object-fit:contain;cursor:zoom-in}}@media(max-width:767px){.modal-gallery-side{height:40vh;background:#f3f3f3;display:flex;align-items:center;justify-content:center;flex-shrink:0}.modal-img-main{width:100%;height:100%;object-fit:cover;cursor:zoom-in}.modal-info-side{padding:15px;overflow-y:auto;flex:1;display:flex;flex-direction:column}}.modal-close-btn{position:absolute;top:15px;right:15px;width:35px;height:35px;background:rgba(255,255,255,0.9);border-radius:50%;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:100;font-size:1.2rem}.modal-title{font-size:1.3rem;font-family:'Playfair Display',serif;margin-bottom:5px;line-height:1.1;margin-top:0}.modal-price{font-size:1.6rem;color:var(--primary);font-weight:700;margin:8px 0}.modal-tag{align-self:flex-end;background:#eee;padding:4px 12px;border-radius:20px;font-size:0.8rem;color:#666;font-weight:500;margin-bottom:5px}.modal-thumbs{display:flex;gap:8px;overflow-x:auto;padding-bottom:10px;margin-bottom:15px;flex-shrink:0;min-height:60px}.thumb-item{width:50px;height:50px;border-radius:8px;object-fit:cover;cursor:pointer;border:2px solid transparent;flex-shrink:0}.thumb-item.active{border-color:var(--primary)}.btn-wa-modal{width:100%;background:#25D366;color:white;border:none;padding:12px;border-radius:12px;font-weight:600;font-size:0.95rem;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;margin-top:auto;flex-shrink:0}.btn-share{border:1px solid var(--primary);background:transparent;color:var(--primary);width:100%;padding:8px;border-radius:12px;font-weight:600;margin-top:10px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:5px}.lightbox{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;z-index:3000;display:none;align-items:center;justify-content:center;cursor:zoom-out}.lightbox img{max-width:100%;max-height:100%;object-fit:contain}#name-modal .modal-content{max-width:400px;height:auto;padding:30px;text-align:center}#user-name-input{width:100%;padding:12px;border:1px solid #ccc;border-radius:8px;margin:20px 0}
/* ESTILOS SORTEO PRO COMPACTO */
.raffle-banner{background:linear-gradient(45deg,#FFD700,#FDB931);color:#000;padding:20px;border-radius:15px;margin:30px auto;text-align:center;box-shadow:0 4px 15px rgba(255,215,0,0.4);animation:pulse 3s infinite;cursor:pointer;display:none;flex-direction:column;align-items:center;gap:5px}.raffle-banner h3{font-family:'Playfair Display';font-size:1.5rem;margin:0;color:#333}.raffle-banner span{background:#000;color:#FFD700;padding:2px 10px;border-radius:20px;font-size:0.8rem;font-weight:bold;margin-top:5px}.raffle-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(30px,1fr));gap:5px;margin-top:10px;max-height:180px;overflow-y:auto;padding:2px}.num-box{background:#f3f4f6;border:1px solid #e5e7eb;border-radius:6px;height:30px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:0.75rem;cursor:pointer;transition:.2s;color:#4b5563}.num-box:hover{border-color:var(--primary)}.num-box.selected{background:#10B981;color:white;border-color:#059669;box-shadow:0 2px 5px rgba(16,185,129,0.3)}.num-box.sold{background:#fee2e2;color:#ef4444;text-decoration:line-through;cursor:not-allowed;border-color:#fecaca;opacity:0.5}.raffle-prizes{list-style:none;margin:5px 0 10px;padding:0;font-size:0.9rem}.raffle-prize-item{display:flex;align-items:center;gap:8px;padding:4px 0;border-bottom:1px solid rgba(0,0,0,0.05);color:var(--text);line-height:1.2}.raffle-header{display:flex;justify-content:space-between;align-items:flex-start}.raffle-badge-right{background:#FFD700;color:#000;padding:2px 8px;border-radius:4px;font-size:0.6rem;font-weight:800;letter-spacing:0.5px;text-transform:uppercase;margin-left:auto}
/* PAGINACI√ìN */
.pagination{display:flex;justify-content:center;gap:8px;margin-top:30px;flex-wrap:wrap}
.page-btn{background:var(--white);border:1px solid #ddd;color:var(--text);width:35px;height:35px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-weight:600;transition:.2s}
.page-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.page-btn:hover:not(.active){background:#eee}
</style>
</head>
<body class="dark-mode">
<script type="application/json" id="site-data">{"config":{},"categories":[],"products":[],"raffle":{}}</script>
<header><div class="container logo" id="header-branding">Muebles</div></header>
<section class="hero"><img src="" class="hero-bg" id="hero-img"><div class="container" style="position:relative;z-index:2"><h1 id="hero-title"></h1><p id="hero-subtitle"></p><a href="#catalogo" class="btn-primary">Ver Cat√°logo</a></div></section>
<section class="container" style="margin-bottom:40px"><h2 style="font-family:'Playfair Display';font-size:1.8rem;color:var(--primary);margin-bottom:20px">Destacados</h2><div class="carousel-container" id="featured-container"></div></section>
<!-- BANNER SORTEO -->
<div class="container" id="raffle-banner-container">
    <div class="raffle-banner" id="raffle-banner" onclick="openRaffleModal()">
        <h3>üéüÔ∏è GRAN SORTEO</h3>
        <p style="margin:0;font-size:0.95rem">¬°Particip√° y gan√° premios incre√≠bles!</p>
        <span>CLIC PARA VER N√öMEROS</span>
    </div>
</div>
<section class="container" id="catalogo">
    <div class="search-wrapper"><svg class="search-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg><input type="text" class="search-input" placeholder="Buscar..." onkeyup="handleSearch(this.value)"></div>
    <div class="filters" id="filters-container"></div>
    <div class="grid" id="products-grid"></div>
    <div id="pagination-controls" class="pagination"></div>
</section>
<section class="closing-section"><div class="closing-box"><div class="shipping-badge">Hacemos env√≠os a Santiago y La Banda</div><h3 class="closing-title">¬°Gracias por tu visita!</h3><p class="closing-text" id="about-text"></p><p style="color:#E48F45;font-weight:600;margin-top:10px">¬°Te esperamos!</p></div></section>
<footer><div class="container"><p style="font-size:1.1rem;margin-bottom:20px">Consult√° precios y stock por WhatsApp</p><button class="btn-footer-wa" id="main-wa-btn"><svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.711 2.592 2.654-.696c1.001.572 1.973.911 3.033.911 3.18 0 5.767-2.587 5.767-5.766.001-3.182-2.585-5.768-5.766-5.768zm0 9.778c-1.091 0-2.126-.352-2.923-.96l-1.397.368.374-1.365c-.75-.92-1.157-1.996-1.156-3.055 0-2.213 1.8-4.013 4.012-4.013 2.21 0 4.01 1.8 4.01 4.013 0 2.214-1.799 4.013-4.01 4.013z"></path></svg>Cont√°ctanos</button><div style="margin-top:30px"><button class="theme-toggle-btn" onclick="document.body.classList.toggle('dark-mode')"><svg viewBox="0 0 24 24"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.93c.39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0l-1.41 1.41c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0l1.41-1.41zm13.42 13.42c.39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0l-1.41 1.41c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0l1.41-1.41zM5.99 19.07c-1.02-1.02-2.34-1.34-1.41 0l-1.41 1.41c-1.12 1.12.29 2.53 1.41 1.41l1.41-1.41c.39-.39.39-1.02 0-1.41zM19.07 5.99c.39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0l-1.41 1.41c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0l1.41-1.41z"/></svg></button></div><p style="font-size:0.8rem;color:#444;margin-top:20px">¬© 2026 Muebles.</p></div></footer>

<div class="modal" id="product-modal"><div class="modal-content"><button class="modal-close-btn" onclick="closeModal()">√ó</button><div class="modal-gallery-side"><img src="" class="modal-img-main" id="m-img" title="Tocar para ampliar"></div><div class="modal-info-side"><span class="modal-tag" id="m-cat">Cat</span><h2 class="modal-title" id="m-title">T√≠tulo</h2><div class="modal-price" id="m-price">$0</div><p style="margin-bottom:10px"><strong>Medidas:</strong> <span id="m-dims"></span></p><p style="color:#666;line-height:1.6;margin-bottom:20px;font-size:0.9rem" id="m-desc"></p><div class="modal-thumbs" id="m-thumbs"></div><button class="btn-wa-modal" id="m-wa"><svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.711 2.592 2.654-.696c1.001.572 1.973.911 3.033.911 3.18 0 5.767-2.587 5.767-5.766.001-3.182-2.585-5.768-5.766-5.768zm0 9.778c-1.091 0-2.126-.352-2.923-.96l-1.397.368.374-1.365c-.75-.92-1.157-1.996-1.156-3.055 0-2.213 1.8-4.013 4.012-4.013 2.21 0 4.01 1.8 4.01 4.013 0 2.214-1.799 4.013-4.01 4.013z"></path></svg><span id="wa-text">Consultar en WhatsApp</span></button><button class="btn-share" onclick="shareProduct()"><svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>Compartir</button></div></div></div>
<div class="modal" id="raffle-modal"><div class="modal-content"><button class="modal-close-btn" onclick="closeRaffleModal()">√ó</button><div class="modal-gallery-side"><img src="" class="modal-img-main" id="r-img" onclick="openRaffleLightbox()"></div><div class="modal-info-side"><div class="raffle-header"><h2 class="modal-title" style="margin:0;font-size:1.3rem;" id="r-title"></h2><span class="raffle-badge-right">SORTEO ACTIVO</span></div><div id="r-price-tag" style="font-size:1rem;color:var(--primary);font-weight:700;margin-bottom:10px;"></div><ul class="raffle-prizes" id="r-prizes"></ul><div style="margin-top:auto"><p style="font-size:0.85rem;color:#666;margin-bottom:5px">Toc√° los n√∫meros para seleccionarlos:</p><div class="raffle-grid" id="r-grid"></div><button class="btn-wa-modal" onclick="buyRaffleNumber()" id="btn-raffle-action" style="margin-top:10px;opacity:0.5;pointer-events:none;">üéüÔ∏è SELECCIONA N√öMEROS</button></div></div></div></div>
<div class="lightbox" id="lightbox" onclick="this.style.display='none'"><img id="lightbox-img" src=""></div><div class="modal" id="name-modal" style="z-index:2100"><div class="modal-content" style="max-height:auto;position:relative"><button onclick="document.getElementById('name-modal').classList.remove('open')" style="position:absolute;top:10px;right:10px;background:transparent;border:none;font-size:1.5rem;color:#666;cursor:pointer;">√ó</button><h3>¬°Hola! üëã</h3><p style="color:#666;margin-bottom:15px">Dinos tu nombre para iniciar el chat:</p><input type="text" id="user-name-input" placeholder="Tu nombre..."><button class="btn-primary" onclick="confirmName()" style="width:100%">Ir a WhatsApp</button></div></div>
<script>
let db={};try{db=JSON.parse(document.getElementById('site-data').textContent);}catch(e){}const config=db.config||{},products=db.products||[],categories=db.categories||[],raffle=db.raffle||{};document.getElementById('header-branding').innerHTML=config.logo?("<img src='"+config.logo+"'>"):config.name;document.getElementById('hero-title').innerText=config.heroTitle;document.getElementById('hero-subtitle').innerText=config.heroSubtitle;document.getElementById('hero-img').src=config.heroImage;document.getElementById('about-text').innerText=config.aboutText;document.title=config.name;let currentCat='Todos',searchTerm='',pendingContact=null,selectedRaffleNums=new Set();const filtersDiv=document.getElementById('filters-container');filtersDiv.innerHTML="<button class='filter-btn active' onclick=\"filter('Todos', this)\">Todos</button>"+categories.map(c=>"<button class='filter-btn' onclick=\"filter('"+c+"', this)\">"+c+"</button>").join('');const fmtPrice=(p)=>new Intl.NumberFormat('es-AR',{style:'decimal',minimumFractionDigits:0}).format(p);

// PAGINATION LOGIC
let currentPage = 1;
const itemsPerPage = 10;

function filter(cat,btn){currentCat=cat;currentPage=1;document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');renderGrid()}
function handleSearch(val){searchTerm=val.toLowerCase();currentPage=1;renderGrid()}

function renderGrid(){
    const grid=document.getElementById('products-grid');grid.innerHTML='';
    let filtered=products.filter(p=>{const match=(currentCat==='Todos'||p.category===currentCat)&&(p.name.toLowerCase().includes(searchTerm)||p.category.toLowerCase().includes(searchTerm)||(p.desc&&p.desc.toLowerCase().includes(searchTerm)));return match});
    filtered.sort((a,b)=>(a.noStock===b.noStock)?0:a.noStock?1:-1);

    // PAGINATION SLICE
    const totalPages = Math.ceil(filtered.length / itemsPerPage);
    if(currentPage > totalPages) currentPage = 1;
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const paginatedItems = filtered.slice(startIndex, endIndex);

    if(filtered.length===0)grid.innerHTML='<p style=\"grid-column:1/-1;text-align:center;color:#999\">Sin resultados</p>';
    
    paginatedItems.forEach(p=>{const c=document.createElement('article');c.className='product-card'+(p.noStock?' out-of-stock':'');c.onclick=()=>openModal(p.id);let priceHtml=p.price?"<div class='card-price'>$"+fmtPrice(p.price)+"</div>":'';let stockBadge=p.noStock?"<div class='stock-badge'>SIN STOCK</div>":"";c.innerHTML=stockBadge+"<div class='card-img-container'><img src='"+p.img+"' loading='lazy' onerror=\"this.src='https://via.placeholder.com/300'\"></div><div class='card-body'><span class='card-cat'>"+p.category+"</span><h3 class='card-title'>"+p.name+"</h3>"+priceHtml+"</div>";grid.appendChild(c)});

    renderPaginationControls(totalPages);
}

function renderPaginationControls(total) {
    const container = document.getElementById('pagination-controls');
    container.innerHTML = '';
    if (total <= 1) return;

    // PREV
    if(currentPage > 1) {
        const btn = document.createElement('div'); btn.className = 'page-btn'; btn.innerText = '<';
        btn.onclick = () => { currentPage--; renderGrid(); document.getElementById('catalogo').scrollIntoView({behavior:'smooth'}); };
        container.appendChild(btn);
    }

    // NUMBERS
    for(let i=1; i<=total; i++) {
        const btn = document.createElement('div'); btn.className = 'page-btn ' + (i===currentPage ? 'active' : ''); btn.innerText = i;
        btn.onclick = () => { currentPage = i; renderGrid(); document.getElementById('catalogo').scrollIntoView({behavior:'smooth'}); };
        container.appendChild(btn);
    }

    // NEXT
    if(currentPage < total) {
        const btn = document.createElement('div'); btn.className = 'page-btn'; btn.innerText = '>';
        btn.onclick = () => { currentPage++; renderGrid(); document.getElementById('catalogo').scrollIntoView({behavior:'smooth'}); };
        container.appendChild(btn);
    }
}

const feat=products.filter(p=>p.featured);const carCont=document.getElementById('featured-container');if(feat.length){carCont.innerHTML=feat.map(p=>"<div class='featured-card' onclick='openModal("+p.id+")'><img src='"+p.img+"' class='featured-img'><div class='featured-overlay'><div class='featured-title'>"+p.name+"</div><div class='featured-detail'>( Ver detalles )</div></div></div>").join('');let autoScrollInterval;function startAutoScroll(){clearInterval(autoScrollInterval);autoScrollInterval=setInterval(()=>{const maxScroll=carCont.scrollWidth-carCont.clientWidth;if(carCont.scrollLeft>=maxScroll-5){carCont.scrollTo({left:0,behavior:'smooth'})}else{carCont.scrollBy({left:280,behavior:'smooth'})}},3000)}startAutoScroll();carCont.addEventListener('touchstart',()=>clearInterval(autoScrollInterval));carCont.addEventListener('touchend',()=>startAutoScroll())}function openModal(id){const p=products.find(x=>x.id===id);if(!p)return;document.body.classList.add('modal-open');document.getElementById('m-img').src=p.img;document.getElementById('m-cat').innerText=p.category;document.getElementById('m-title').innerText=p.name;document.getElementById('m-dims').innerText=p.dims;document.getElementById('m-desc').innerHTML=p.desc;const priceEl=document.getElementById('m-price');if(p.price){priceEl.innerText="$"+fmtPrice(p.price);priceEl.style.display='block'}else priceEl.style.display='none';const thumbsDiv=document.getElementById('m-thumbs');thumbsDiv.innerHTML='';const allImgs=[p.img].concat(p.gallery||[]);if(allImgs.length>1){thumbsDiv.style.display='flex';allImgs.forEach((src,i)=>{const img=document.createElement('img');img.src=src;img.className=i===0?'thumb-item active':'thumb-item';img.onclick=()=>{document.getElementById('m-img').src=src;document.querySelectorAll('.thumb-item').forEach(x=>x.classList.remove('active'));img.classList.add('active')};thumbsDiv.appendChild(img)})}else thumbsDiv.style.display='none';document.getElementById('m-img').onclick=()=>{document.getElementById('lightbox-img').src=document.getElementById('m-img').src;document.getElementById('lightbox').style.display='flex'};const waBtn=document.getElementById('m-wa');if(p.noStock){waBtn.style.background='#6b7280';document.getElementById('wa-text').innerText='Consultar Reposici√≥n'}else{waBtn.style.background='#25D366';document.getElementById('wa-text').innerText='Consultar en WhatsApp'}waBtn.onclick=()=>openNameModal(p);document.getElementById('product-modal').classList.add('open')}function closeModal(){document.getElementById('product-modal').classList.remove('open');document.body.classList.remove('modal-open')}document.getElementById('main-wa-btn').onclick=()=>openNameModal(null);function openNameModal(p){pendingContact=p;document.getElementById('name-modal').classList.add('open');setTimeout(()=>document.getElementById('user-name-input').focus(),100)}function getArticle(name){const lower=name.toLowerCase().trim();if(lower.endsWith('a')&&!lower.endsWith('sof√°'))return 'la';return 'el'}function confirmName(){const n=document.getElementById('user-name-input').value.trim();if(!n)return alert("Por favor escribe tu nombre");let t="";if(selectedRaffleNums.size>0){const wa=raffle.whatsapp||config.whatsapp;const nums=[...selectedRaffleNums].sort((a,b)=>a-b).map(x=>x.toString().padStart(2,'0')).join(', ');t="Hola! Me llamo "+n+". Quiero reservar los n√∫meros: "+nums+" del sorteo \""+raffle.title+"\".";window.open("https://wa.me/"+wa+"?text="+encodeURIComponent(t),'_blank');selectedRaffleNums.clear();renderRaffleGrid();updateRaffleUI();}else if(pendingContact){const art=getArticle(pendingContact.name);const action=pendingContact.noStock?"consultar cu√°ndo vuelve a entrar":"consultar por";t="Hola! Me llamo "+n+". Quer√≠a "+action+" "+art+" \""+pendingContact.name+"\" que vi en su p√°gina."}else{t="Hola! Me llamo "+n+". Les escribo para ponerme en contacto con ustedes y consultarles sobre los muebles que vi en su p√°gina."}if(selectedRaffleNums.size===0) window.open("https://wa.me/"+config.whatsapp+"?text="+encodeURIComponent(t),'_blank');document.getElementById('name-modal').classList.remove('open')}function shareProduct(){if(navigator.share){navigator.share({title:document.getElementById('m-title').innerText,text:'Mir√° este mueble de '+config.name,url:window.location.href}).catch(console.error)}else{alert("Copi√° este link: "+window.location.href)}}document.getElementById('user-name-input').onkeypress=(e)=>{if(e.key==='Enter')confirmName()};
if(raffle && raffle.active){const b=document.getElementById('raffle-banner');b.style.display='flex';}
function openRaffleModal(){document.getElementById('r-title').innerText=raffle.title;document.getElementById('r-img').src=raffle.img;document.getElementById('r-price-tag').innerText=raffle.price?'Valor: $'+fmtPrice(raffle.price):'Gratis';const pl=document.getElementById('r-prizes');pl.innerHTML='';if(raffle.prizes){raffle.prizes.forEach((p,i)=>{const icons=['üèÜ','ü•à','ü•â'];const icon=icons[i]||'üèÖ';const li=document.createElement('li');li.className='raffle-prize-item';li.innerHTML='<span style="font-size:1.1rem;margin-right:5px">'+icon+'</span> <b>'+(i+1)+'¬∞ Premio:</b>&nbsp;'+p.name;pl.appendChild(li)})}selectedRaffleNums.clear();renderRaffleGrid();updateRaffleUI();document.getElementById('raffle-modal').classList.add('open');document.body.classList.add('modal-open');}
function renderRaffleGrid(){const grid=document.getElementById('r-grid');grid.innerHTML='';const tot=raffle.total||100;const sold=raffle.sold||[];for(let i=1;i<=tot;i++){const num=i;const isSold=sold.includes(i);const div=document.createElement('div');div.className='num-box '+(isSold?'sold':'');div.innerText=i.toString().padStart(2,'0');if(!isSold){div.onclick=()=>{if(selectedRaffleNums.has(num)) selectedRaffleNums.delete(num); else selectedRaffleNums.add(num);div.classList.toggle('selected');updateRaffleUI();}}grid.appendChild(div);}}
function updateRaffleUI(){const btn=document.getElementById('btn-raffle-action');const count=selectedRaffleNums.size;if(count>0){btn.style.opacity='1';btn.style.pointerEvents='auto';btn.innerText='üéüÔ∏è PEDIR '+count+' N√öMERO'+(count>1?'S':'');btn.style.background='#10B981';}else{btn.style.opacity='0.5';btn.style.pointerEvents='none';btn.innerText='üéüÔ∏è SELECCIONA N√öMEROS';btn.style.background='#25D366';}}
function closeRaffleModal(){document.getElementById('raffle-modal').classList.remove('open');document.body.classList.remove('modal-open');selectedRaffleNums.clear();updateRaffleUI();}function buyRaffleNumber(){pendingContact=null;document.getElementById('name-modal').classList.add('open');setTimeout(()=>document.getElementById('user-name-input').focus(),100);}function openRaffleLightbox(){document.getElementById('lightbox-img').src=document.getElementById('r-img').src;document.getElementById('lightbox').style.display='flex';}
renderGrid();
</script>
</body>
</html>
    </textarea>

    <script>
        // --- AUTH & SWIPE LOGIC ---
        let currentPanel = 0;
        let touchStartX = 0;
        
        window.addEventListener('load', () => {
            const savedPass = localStorage.getItem('editor_pass');
            if(!savedPass) localStorage.setItem('editor_pass', '1234'); 
        });

        function checkLogin() {
            const pass = document.getElementById('login-pass').value;
            const saved = localStorage.getItem('editor_pass');
            if(pass === saved) {
                document.getElementById('login-screen').style.transform = 'translateY(-100%)';
                setTimeout(() => switchPanel(0), 300);
                if(localStorage.getItem('muebles_draft')) document.getElementById('draft-alert').style.display='block';
                ['gh_user','gh_repo','gh_token','gh_folder'].forEach(k=>{const v=localStorage.getItem(k);if(v&&document.getElementById(k.replace('_','-')))document.getElementById(k.replace('_','-')).value=v;});
            } else {
                alert("Contrase√±a incorrecta");
                document.getElementById('login-pass').value = '';
            }
        }

        // TOGGLE PASSWORD
        function togglePass(id, btn) {
            const input = document.getElementById(id);
            if (input.type === "password") {
                input.type = "text";
                btn.textContent = "üôà"; 
            } else {
                input.type = "password";
                btn.textContent = "üëÅÔ∏è"; 
            }
            btn.classList.remove('eye-pop');
            void btn.offsetWidth; // Force reflow
            btn.classList.add('eye-pop');
        }

        function openPassModal() { document.getElementById('pass-modal').classList.add('open'); }

        function changePassword() {
            const np = document.getElementById('new-password').value;
            if(np.trim().length > 3) {
                localStorage.setItem('editor_pass', np.trim());
                alert("Contrase√±a actualizada");
                document.getElementById('pass-modal').classList.remove('open');
                document.getElementById('new-password').value = '';
            } else {
                alert("M√≠nimo 4 caracteres");
            }
        }

        // Swipe
        const mainEl = document.getElementById('main-content');
        mainEl.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; }, {passive: true});
        mainEl.addEventListener('touchend', e => {
            const touchEndX = e.changedTouches[0].screenX;
            if(Math.abs(touchEndX - touchStartX) > 70) {
                if(touchEndX < touchStartX) navigatePanel(1);
                else navigatePanel(-1);
            }
        }, {passive: true});

        function navigatePanel(dir) {
            const total = 6; let next = currentPanel + dir;
            if(next < 0) next = 0; if(next >= total) next = total - 1;
            if(next !== currentPanel) switchPanel(next);
        }

        function switchPanel(i){
            currentPanel = i;
            document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
            document.getElementById(`panel-${i}`).classList.add('active');
            document.querySelectorAll('.nav-pill').forEach((n, idx) => {
                if(idx === i) { n.classList.add('active'); n.scrollIntoView({behavior: "smooth", inline: "center", block: "nearest"}); } 
                else n.classList.remove('active');
            });
        }

        // --- EDITOR LOGIC ---
        let db={config:{},categories:[],products:[],raffle:{prizes:[],sold:[]}}, originalHTML="", resultadosOpt=[];
        let dragSrcEl = null, editorSoldNums = new Set();

        function getBaseTemplate() { return document.getElementById('master-template').value; }
        function saveGitHubCreds(){localStorage.setItem('gh_user',document.getElementById('gh-user').value.trim());localStorage.setItem('gh_repo',document.getElementById('gh-repo').value.trim());localStorage.setItem('gh_token',document.getElementById('gh-token').value.trim());localStorage.setItem('gh_folder',document.getElementById('gh-folder').value.trim());alert("Guardado.");}
        
        async function uploadToGithub(idx, btn, silent=false) {
            const u=localStorage.getItem('gh_user'),r=localStorage.getItem('gh_repo'),t=localStorage.getItem('gh_token');
            let f=localStorage.getItem('gh_folder')||'';
            if(!u||!r||!t){ if(!silent) alert("Configura GitHub primero"); return false; }
            f = f.replace(/^\/+|\/+$/g, ''); if(f) f += '/';
            const item=resultadosOpt[idx];
            let customName = item.nombre;
            if(!silent) { customName = prompt("Nombre archivo:", item.nombre.replace('.webp','')); if(!customName) return false; }
            customName = customName.replace(/[^a-zA-Z0-9-_]/g, '-').toLowerCase(); if(!customName.endsWith('.webp')) customName += '.webp';
            const old=btn.innerHTML; btn.innerHTML="‚è≥"; btn.disabled=true;
            try {
                const reader=new FileReader(); reader.readAsDataURL(item.blob);
                return new Promise(resolve => {
                    reader.onloadend=async()=>{
                        const path = `${f}${customName}`;
                        const res=await fetch(`https://api.github.com/repos/${u}/${r}/contents/${path}`,{
                            method:'PUT', headers:{'Authorization':`token ${t}`,'Content-Type':'application/json'},
                            body:JSON.stringify({message:`Upload ${customName}`,content:reader.result.split(',')[1]})
                        });
                        const d=await res.json();
                        if(res.ok){
                            const url = d.content.download_url;
                            const parent = btn.parentElement.parentElement;
                            parent.innerHTML = `
                                <input type="text" value="${url}" readonly style="width:100%;font-size:0.8rem;border:1px solid #ddd;padding:4px;border-radius:4px;margin-bottom:2px;" onclick="this.select();document.execCommand('copy');this.style.background='#dcfce7';">
                                <div style="font-size:0.75rem;color:#059669;font-weight:bold;margin-bottom:4px;">‚úÖ Subido</div>
                                <button onclick="useImageInNewProduct('${url}')" class="btn-opt-single" style="background:#eff6ff;color:#2563EB;">‚ú® Crear Prod</button>
                            `;
                            resolve(true);
                        } else { 
                            let msg = d.message;
                            if(res.status === 401) msg = "Token inv√°lido";
                            if(res.status === 404) msg = "Repo no existe";
                            if(!silent) alert("Error: "+msg); 
                            btn.innerHTML="Error"; btn.disabled=false; resolve(false); 
                        }
                    };
                });
            } catch(e) { if(!silent) alert("Error: "+e.message); btn.innerHTML="Error"; return false; }
        }

        function useImageInNewProduct(url) {
            switchPanel(3); // Ir a productos
            openProductModal(); // Crear nuevo
            document.getElementById('prod-img').value = url;
            // Scroll al inicio del modal
            document.querySelector('.modal-body-grid').scrollTop = 0;
        }

        async function batchUpload(){
            if(resultadosOpt.length === 0) return alert("Sube im√°genes primero");
            if(!confirm("¬øSubir todo a GitHub?")) return;
            for(let i=0; i<resultadosOpt.length; i++){
                const btn = document.querySelector(`button[data-idx="${i}"]`);
                if(btn){ btn.scrollIntoView({behavior:'smooth', block:'center'}); await uploadToGithub(i, btn, true); }
            }
            alert("Listo");
        }

        async function publishToGithub() {
            const u=localStorage.getItem('gh_user'), r=localStorage.getItem('gh_repo'), t=localStorage.getItem('gh_token');
            if(!u||!r||!t) return alert("Falta Config GitHub");
            if(!confirm("¬øPublicar web?")) return;
            const btn = document.querySelector('.fab-publish');
            const oldText = btn.innerHTML; btn.innerHTML = "‚è≥"; btn.disabled = true;
            saveRaffle(false); saveGeneral();
            const sourceHTML = getBaseTemplate();
            const doc = new DOMParser().parseFromString(sourceHTML, 'text/html');
            doc.getElementById('site-data').textContent = JSON.stringify(db, null, 4);
            const content = btoa(unescape(encodeURIComponent(doc.documentElement.outerHTML)));
            try {
                let sha = "";
                const getRes = await fetch(`https://api.github.com/repos/${u}/${r}/contents/index.html`, { headers: { 'Authorization': `token ${t}` } });
                if(getRes.ok) { const getData = await getRes.json(); sha = getData.sha; }
                const body = { message: "Update via Editor", content: content }; if(sha) body.sha = sha;
                const putRes = await fetch(`https://api.github.com/repos/${u}/${r}/contents/index.html`, {
                    method: 'PUT', headers: { 'Authorization': `token ${t}`, 'Content-Type': 'application/json' }, body: JSON.stringify(body)
                });
                if(putRes.ok) alert("‚úÖ Publicado"); 
                else {
                    let msg = "Error al subir";
                    if(putRes.status === 401) msg = "Error: Token inv√°lido o expirado";
                    if(putRes.status === 404) msg = "Error: Repositorio no encontrado";
                    alert(msg);
                }
            } catch(e) { alert("Error conexi√≥n"); }
            btn.innerHTML = oldText; btn.disabled = false;
        }

        function loadFile(inp){const r=new FileReader();r.onload=e=>{originalHTML=e.target.result;try{const doc=new DOMParser().parseFromString(originalHTML,'text/html'),sc=doc.getElementById('site-data');if(sc){db=JSON.parse(sc.textContent);if(!db.products)db.products=[];if(!db.categories)db.categories=[];if(!db.raffle)db.raffle={prizes:[],sold:[]};document.getElementById('status').innerText="‚úÖ Cargado";refreshUI();}}catch(e){alert("Error archivo");}};r.readAsText(inp.files[0]);}
        function updateTemplateBase(inp){ const r=new FileReader(); r.onload=e=>{ const newTpl = e.target.result; if(newTpl.includes('id="site-data"')) { document.getElementById('master-template').value = newTpl; alert("Dise√±o actualizado"); } }; r.readAsText(inp.files[0]); }

        function refreshUI(){
            document.getElementById('cfg-name').value=db.config.name||'';
            let wa=db.config.whatsapp||''; if(wa.startsWith('549'))wa=wa.substring(3); document.getElementById('cfg-whatsapp').value=wa;
            ['cfg-logo','cfg-heroTitle','cfg-heroSubtitle','cfg-heroImage','cfg-aboutText'].forEach(id=>{
                document.getElementById(id).value=db.config[id.replace('cfg-','')]||'';
            });
            renderCats(); renderProdList(); renderRafflePanel();
            updateDashboardStats(); 
        }

        function updateDashboardStats() {
            const count = db.products ? db.products.length : 0;
            document.getElementById('stat-prod-count').innerText = count;
            const r = db.raffle || {};
            const isActive = r.active;
            const raffleStatusEl = document.getElementById('stat-raffle-status');
            const raffleInfoEl = document.getElementById('stat-raffle-info');
            if (isActive) {
                const total = r.total || 100;
                const soldCount = (r.sold || []).length;
                const free = total - soldCount;
                raffleStatusEl.innerText = "üü¢ ACTIVO";
                raffleStatusEl.style.color = "var(--green)";
                raffleStatusEl.style.fontWeight = "bold";
                raffleInfoEl.innerHTML = `<span style="font-size:1.4rem; font-weight:800; color:#1f2937">${free}</span><span style="font-size:0.7rem; display:block; color:#666">Libres</span>`;
            } else {
                raffleStatusEl.innerText = "üî¥ OFF";
                raffleStatusEl.style.color = "var(--danger)";
                raffleStatusEl.style.fontWeight = "bold";
                raffleInfoEl.innerHTML = `<span style="font-size:0.75rem; color:#9ca3af; display:block; margin-top:5px;">Sin Sorteo</span>`;
            }
        }

        function saveGeneral(){
            db.config.name=document.getElementById('cfg-name').value;
            let raw=document.getElementById('cfg-whatsapp').value.replace(/\D/g,''); db.config.whatsapp=raw?'549'+raw:'';
            ['logo','heroTitle','heroSubtitle','heroImage','aboutText'].forEach((k,i)=>{
                const ids=['cfg-logo','cfg-heroTitle','cfg-heroSubtitle','cfg-heroImage','cfg-aboutText'];
                db.config[k]=document.getElementById(ids[i]).value;
            });
        }
        function renderCats(){
            const html = db.categories.map((c,i)=>`<div class="cat-chip">${c} <button class="cat-btn-action" onclick="editCat(${i})">‚úèÔ∏è</button><button class="cat-btn-action" onclick="if(confirm('¬øBorrar?')){db.categories.splice(${i},1);renderCats();}">√ó</button></div>`).join('');
            document.getElementById('cat-list').innerHTML=html;
            const filterSel = document.getElementById('prod-filter-cat');
            filterSel.innerHTML = '<option value="all">Todo</option>' + db.categories.map(c=>`<option value="${c}">${c}</option>`).join('');
            document.getElementById('prod-cat').innerHTML = db.categories.map(c=>`<option value="${c}">${c}</option>`).join('');
        }
        function addCategory(){const v=document.getElementById('new-cat').value.trim();if(v&&!db.categories.includes(v)){db.categories.push(v);document.getElementById('new-cat').value='';renderCats();}}
        function editCat(index) { const oldName = db.categories[index]; const newName = prompt("Nuevo nombre:", oldName); if (newName && newName.trim() !== "") { db.categories[index] = newName.trim(); db.products.forEach(p => { if (p.category === oldName) p.category = newName.trim(); }); renderCats(); renderProdList(); } }

        function openProductModal(id=null){
            document.getElementById('extra-img-container').innerHTML='';
            if(id!==null){
                const p=db.products.find(x=>x.id===id);
                document.getElementById('prod-id').value=p.id; document.getElementById('prod-name').value=p.name; document.getElementById('prod-cat').value=p.category;
                document.getElementById('prod-dims').value=p.dims; document.getElementById('prod-price').value=p.price; document.getElementById('prod-img').value=p.img;
                document.getElementById('prod-desc').value=p.desc; 
                document.getElementById('prod-featured').checked = !!p.featured;
                document.getElementById('prod-nostock').checked = !!p.noStock;
                if(p.gallery)p.gallery.forEach(u=>addExtraImgField(u));
            }else{
                ['prod-id','prod-name','prod-dims','prod-price','prod-img','prod-desc'].forEach(i=>document.getElementById(i).value='');
                document.getElementById('prod-featured').checked=false; document.getElementById('prod-nostock').checked=false;
            }
            document.getElementById('product-modal').classList.add('open');
        }
        
        function addExtraImgField(v=''){const d=document.createElement('div');d.className='extra-img-row';d.innerHTML=`<input type="text" class="extra-img-input" value="${v}" placeholder="URL..."><button type="button" onclick="this.parentElement.remove()">√ó</button>`;document.getElementById('extra-img-container').appendChild(d);}
        
        function saveProduct(){
            const id=document.getElementById('prod-id').value, g=[];
            document.querySelectorAll('.extra-img-input').forEach(i=>{if(i.value)g.push(i.value);});
            const np={
                id:id?parseInt(id):Date.now(), name:document.getElementById('prod-name').value, category:document.getElementById('prod-cat').value,
                dims:document.getElementById('prod-dims').value, price:document.getElementById('prod-price').value, img:document.getElementById('prod-img').value,
                gallery:g, desc:document.getElementById('prod-desc').value,
                featured: document.getElementById('prod-featured').checked, noStock: document.getElementById('prod-nostock').checked
            };
            if(id){const ix=db.products.findIndex(x=>x.id==id);if(ix!==-1)db.products[ix]=np;}else db.products.push(np);
            
            closeProductModal();
            renderProdList();
            updateDashboardStats();
        }

        function closeProductModal(){document.getElementById('product-modal').classList.remove('open');}
        
        function moveProduct(id, dir) {
            const idx = db.products.findIndex(p => p.id === id);
            if (idx === -1) return;
            const newIdx = idx + dir;
            if (newIdx < 0 || newIdx >= db.products.length) return;
            // Swap
            [db.products[idx], db.products[newIdx]] = [db.products[newIdx], db.products[idx]];
            renderProdList();
        }

        function cloneProduct(id) {
            const p = db.products.find(x => x.id === id);
            if (!p) return;
            if (!confirm("¬øClonar " + p.name + "?")) return;
            const cloned = JSON.parse(JSON.stringify(p));
            cloned.id = Date.now();
            cloned.name = cloned.name + " (Copia)";
            db.products.unshift(cloned);
            renderProdList();
            updateDashboardStats();
        }

        function renderProdList(){
            const list = document.getElementById('prod-list');
            const term = document.getElementById('prod-search').value.toLowerCase();
            const cat = document.getElementById('prod-filter-cat').value;
            
            const filtered = db.products.filter(p => { const matchName = p.name.toLowerCase().includes(term); const matchCat = cat === 'all' || p.category === cat; return matchName && matchCat; });
            
            list.innerHTML=filtered.map((p, index)=>`
                <div class="prod-card" data-id="${p.id}">
                    ${p.noStock ? '<div class="stock-badge-editor">SIN STOCK</div>' : ''}
                    <img src="${p.img}" class="prod-img">
                    <div class="prod-title">${p.name}</div>
                    <div class="prod-meta"><span>${p.category}</span><span>${p.price?'$'+p.price:''}</span></div>
                    <div class="prod-actions">
                        <button class="btn-card btn-card-tool" onclick="moveProduct(${p.id}, -1)">‚¨ÜÔ∏è</button>
                        <button class="btn-card btn-card-tool" onclick="moveProduct(${p.id}, 1)">‚¨áÔ∏è</button>
                        <button class="btn-card btn-card-tool" onclick="cloneProduct(${p.id})" style="color:var(--primary)">¬©Ô∏è</button>
                        <button class="btn-card btn-card-edit" onclick="openProductModal(${p.id})">EDITAR</button>
                        <button class="btn-card btn-card-del" onclick="if(confirm('Borrar?')){db.products=db.products.filter(x=>x.id!==${p.id});renderProdList();updateDashboardStats();}">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function procesarImagenes(){
            const f=document.getElementById("opt-input").files, g=document.getElementById("opt-grid");
            const quality = parseInt(document.getElementById("opt-quality").value) / 100;
            if(!resultadosOpt.length)g.innerHTML="";
            [...f].forEach((file,i)=>{
                const img=new Image(), r=new FileReader();
                r.onload=e=>img.src=e.target.result; r.readAsDataURL(file);
                img.onload=()=>{
                    const max=1600; let w=img.width,h=img.height; if(w>h&&w>max){h*=max/w;w=max;}else if(h>max){w*=max/h;h=max;}
                    const c=document.createElement("canvas"); c.width=w;c.height=h; c.getContext("2d").drawImage(img,0,0,w,h);
                    c.toBlob(b=>{
                        const url=URL.createObjectURL(b), name=`img-${Date.now()}-${i}.webp`;
                        const idx = resultadosOpt.push({nombre:name,blob:b}) - 1;
                        const card=document.createElement("div"); card.className="opt-card";
                        card.innerHTML=`<button class="btn-del-opt" onclick="this.parentElement.remove()">√ó</button><img src="${url}"><div style="display:flex;gap:2px;justify-content:center;"><button class="btn-opt-single" onclick="const a=document.createElement('a');a.href='${url}';a.download='${name}';a.click();">üíæ</button><button class="btn-opt-single upload-btn" style="background:#eff6ff;color:#2563EB;" onclick="uploadToGithub(${idx},this)" data-idx="${idx}">‚òÅÔ∏è</button></div>`;
                        g.appendChild(card);
                    },"image/webp", quality);
                };
            });
        }
        
        function renderRafflePanel() {
            if(!db.raffle) db.raffle = {prizes:[], sold:[]};
            const r = db.raffle;
            document.getElementById('raffle-active').checked = r.active || false;
            document.getElementById('raffle-status-text').innerText = r.active ? "ACTIVO" : "INACTIVO";
            document.getElementById('raffle-status-text').style.color = r.active ? "#16a34a" : "#b45309";
            
            document.getElementById('raffle-title').value = r.title || '';
            document.getElementById('raffle-img').value = r.img || '';
            document.getElementById('raffle-price').value = r.price || '';
            document.getElementById('raffle-whatsapp').value = r.whatsapp || '';
            document.getElementById('raffle-total').value = r.total || 100;
            
            editorSoldNums = new Set(r.sold || []);
            renderEditorRaffleGrid();

            const container = document.getElementById('prizes-container');
            container.innerHTML = '';
            if(r.prizes) { r.prizes.forEach(p => addPrizeRow(p.name, p.qty)); }
        }

        function toggleRaffleCheck() {
            const cb = document.getElementById('raffle-active');
            cb.checked = !cb.checked;
            document.getElementById('raffle-status-text').innerText = cb.checked ? "ACTIVO" : "INACTIVO";
            document.getElementById('raffle-status-text').style.color = cb.checked ? "#16a34a" : "#b45309";
        }

        function renderEditorRaffleGrid() {
            const grid = document.getElementById('editor-raffle-grid');
            grid.innerHTML = '';
            const total = parseInt(document.getElementById('raffle-total').value) || 100;
            for(let i=1; i<=total; i++) {
                const div = document.createElement('div');
                div.className = 'editor-num-box ' + (editorSoldNums.has(i) ? 'is-sold' : '');
                div.innerText = i.toString().padStart(2, '0');
                div.onclick = () => { toggleEditorSold(i); };
                grid.appendChild(div);
            }
        }

        function toggleEditorSold(num) {
            if(editorSoldNums.has(num)) editorSoldNums.delete(num); else editorSoldNums.add(num);
            renderEditorRaffleGrid();
        }

        function addPrizeRow(name='', qty=1) {
            const div = document.createElement('div'); div.className = 'prize-row';
            div.innerHTML = `<input type="text" placeholder="Premio..." class="prize-name" value="${name}"><input type="number" placeholder="#" class="prize-qty" value="${qty}" style="flex:0.3"><button onclick="this.parentElement.remove()">√ó</button>`;
            document.getElementById('prizes-container').appendChild(div);
        }

        function saveRaffle(alertUser=true) {
            if(!db.raffle) db.raffle = {};
            db.raffle.active = document.getElementById('raffle-active').checked;
            db.raffle.title = document.getElementById('raffle-title').value;
            db.raffle.img = document.getElementById('raffle-img').value;
            db.raffle.price = document.getElementById('raffle-price').value;
            db.raffle.whatsapp = document.getElementById('raffle-whatsapp').value;
            db.raffle.total = parseInt(document.getElementById('raffle-total').value) || 100;
            db.raffle.sold = Array.from(editorSoldNums).sort((a,b)=>a-b);
            const prizes = [];
            document.querySelectorAll('.prize-row').forEach(row => {
                const n = row.querySelector('.prize-name').value;
                const q = row.querySelector('.prize-qty').value;
                if(n) prizes.push({name: n, qty: q});
            });
            db.raffle.prizes = prizes;
            if(alertUser) alert("Sorteo guardado.");
            updateDashboardStats();
        }

        function saveToBrowser(){
            saveRaffle(false); 
            saveGeneral(); 
            localStorage.setItem('muebles_draft',JSON.stringify(db));
            if(originalHTML)localStorage.setItem('muebles_html',originalHTML);
            alert("Guardado en borrador.");
        }
        function loadDraft(){db=JSON.parse(localStorage.getItem('muebles_draft'));if(localStorage.getItem('muebles_html'))originalHTML=localStorage.getItem('muebles_html');refreshUI();document.getElementById('draft-alert').style.display='none';}
        function clearDraft(){localStorage.removeItem('muebles_draft');document.getElementById('draft-alert').style.display='none';}
        
        function exportBackup(){
            saveRaffle(false); 
            saveGeneral(); 
            const a=document.createElement("a");
            a.href=URL.createObjectURL(new Blob([JSON.stringify(db,null,2)],{type:"application/json"}));
            a.download="backup.json";
            a.click();
        }
        function importBackup(inp){const r=new FileReader();r.onload=e=>{db=JSON.parse(e.target.result);refreshUI();};r.readAsText(inp.files[0]);}
        function triggerRestore(){ document.getElementById('restoreInput').click(); }
        
        function downloadSite(){
            saveRaffle(false); 
            saveGeneral(); 
            const sourceHTML = getBaseTemplate();
            const doc=new DOMParser().parseFromString(sourceHTML,'text/html'); 
            doc.getElementById('site-data').textContent=JSON.stringify(db,null,4); 
            const a=document.createElement('a');
            a.href=URL.createObjectURL(new Blob([doc.documentElement.outerHTML],{type:"text/html"}));
            a.download="index.html";
            a.click();
        }
    </script>
</body>
</html>