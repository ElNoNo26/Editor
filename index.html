<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Editor Muebles El Nono v2.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        :root { 
            --primary: #8B5E3C; --bg: #F3F4F6; --sidebar: #1F2937; --text: #1f2937;
            --text-light: #6b7280; --green: #10B981; --blue: #2563EB; --orange: #f97316; --danger: #EF4444;
        }
        * { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); display: flex; height: 100vh; margin: 0; overflow: hidden; color: var(--text); }
        
        aside { width: 260px; background: var(--sidebar); color: #fff; padding: 20px; display: flex; flex-direction: column; flex-shrink: 0; z-index: 10; }
        .nav-menu { display: flex; flex-direction: column; gap: 5px; overflow-y: auto; }
        .nav-item { padding: 12px 15px; cursor: pointer; border-radius: 8px; opacity: 0.8; font-size: 0.95rem; transition: 0.2s; color: #d1d5db; }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.1); opacity: 1; font-weight: 600; color: #fff; }
        
        main { flex: 1; padding: 30px; overflow-y: auto; position: relative; scroll-behavior: smooth; }
        .panel { display: none; max-width: 900px; margin: 0 auto; padding-bottom: 160px; }
        .panel.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 20px; border: 1px solid #e5e7eb; }
        h1 { margin-top: 0; font-size: 1.8rem; margin-bottom: 20px; font-weight: 700; }
        label { display: block; margin-bottom: 6px; font-weight: 500; font-size: 0.9rem; color: #4b5563; }
        input, textarea, select { width: 100%; padding: 10px 12px; margin-bottom: 15px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 0.95rem; background: #fff; font-family: inherit; }
        .row { display: flex; gap: 20px; } .col { flex: 1; }
        
        .fab-container { position: fixed; bottom: 0; left: 0; right: 0; display: flex; justify-content: center; gap: 8px; z-index: 100; pointer-events: none; padding: 15px; background: linear-gradient(to top, rgba(243,244,246,1) 50%, rgba(243,244,246,0)); flex-wrap: wrap; }
        .fab-btn { pointer-events: auto; border: none; border-radius: 50px; padding: 8px 16px; color: white; font-weight: 600; font-size: 0.8rem; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; gap: 6px; }
        .fab-draft { background-color: var(--blue); } .fab-backup { background-color: #8b5cf6; } .fab-restore { background-color: var(--orange); } .fab-download { background-color: var(--green); }

        .prod-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; margin-top: 20px; }
        .prod-card { background: white; border: 1px solid #e5e7eb; border-radius: 12px; padding: 10px; display: flex; flex-direction: column; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .prod-img { width: 100%; height: 120px; object-fit: cover; border-radius: 8px; background: #f3f4f6; margin-bottom: 10px; }
        .prod-title { font-weight: 700; font-size: 0.95rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .prod-actions { display: flex; gap: 8px; margin-top: auto; }
        .btn-card { flex: 1; padding: 6px; border-radius: 6px; border: none; font-size: 0.8rem; font-weight: 600; cursor: pointer; }
        .btn-card-edit { background: #eff6ff; color: var(--blue); } .btn-card-del { background: #fef2f2; color: var(--danger); }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(2px); }
        .modal-overlay.open { display: flex; }
        .modal-content { background: #fff; width: 95%; max-width: 900px; max-height: 90vh; border-radius: 16px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .modal-header { display: flex; justify-content: space-between; padding: 20px 25px; border-bottom: 1px solid #f3f4f6; }
        .modal-body-grid { display: flex; flex: 1; overflow: hidden; }
        .modal-form-side { flex: 1; padding: 25px; overflow-y: auto; }
        .modal-preview-side { width: 320px; background: #f9fafb; padding: 25px; display: flex; flex-direction: column; align-items: center; border-left: 1px solid #e5e7eb; overflow-y: auto; }
        
        .preview-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 260px; }
        .preview-img { width: 100%; height: 200px; object-fit: cover; background: #eee; }
        .preview-body { padding: 15px; }
        .preview-cat { color: var(--orange); font-size: 0.7rem; font-weight: 700; text-transform: uppercase; }
        .preview-name { font-size: 1.1rem; font-weight: 600; margin: 5px 0; color: #333; }
        .preview-price { font-size: 1.2rem; font-weight: 700; color: var(--primary); }

        .btn-save-modal { width: 100%; padding: 12px; background: var(--green); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 10px; }
        .upload-zone { border: 2px dashed #d1d5db; padding: 30px; text-align: center; border-radius: 12px; background: #f9fafb; cursor: pointer; }
        
        .opt-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; margin-top: 20px; }
        .opt-card { background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; padding: 8px; text-align: center; }
        .opt-card img { width: 100%; border-radius: 6px; height: 100px; object-fit: cover; margin-bottom: 5px; cursor: zoom-in; }
        .btn-opt-single { background: #f0fdf4; border: 1px solid var(--green); color: #059669; width: 100%; padding: 6px; border-radius: 6px; cursor: pointer; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 3px; }
        
        .btn-add-cat { background-color: var(--blue); color: white; padding: 0 15px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; height: 43px; }
        /* ESTILOS CATEGORIAS MEJORADOS */
        .cat-chip { background: #fff; border: 1px solid #e5e7eb; padding: 6px 12px; border-radius: 20px; display: inline-flex; margin: 4px; align-items: center; gap: 8px; font-weight: 500; }
        .cat-btn-action { border:none; background:transparent; cursor:pointer; padding:2px; display:flex; align-items:center; border-radius:4px; transition:0.2s; }
        .cat-btn-action:hover { background: #f3f4f6; }
        .cat-icon-edit { color: var(--blue); }
        .cat-icon-del { color: var(--danger); }

        .extra-img-row { display: flex; gap: 8px; margin-bottom: 8px; }

        @media (max-width: 768px) {
            body { flex-direction: column; overflow: auto; }
            aside { width: 100%; padding: 10px; position: sticky; top:0; z-index: 50; }
            .nav-menu { flex-direction: row; width: 100%; overflow-x: auto; margin-top: 10px; padding-bottom: 5px; white-space: nowrap; -webkit-overflow-scrolling: touch; }
            .nav-item { white-space: nowrap; margin-right: 8px; background: rgba(255,255,255,0.1); flex-shrink: 0; }
            .modal-body-grid { flex-direction: column-reverse; overflow-y: auto; }
            .modal-preview-side { width: 100%; border-left: none; border-bottom: 1px solid #eee; }
            .modal-content { overflow-y: auto; }
        }
    </style>
</head>
<body>

    <aside>
        <h2>Panel de Control</h2>
        <div class="nav-menu">
            <div class="nav-item active" onclick="switchPanel(0)">Inicio</div>
            <div class="nav-item" onclick="switchPanel(1)">Config</div>
            <div class="nav-item" onclick="switchPanel(2)">Categor√≠as</div>
            <div class="nav-item" onclick="switchPanel(3)">Art√≠culos</div>
            <div class="nav-item" onclick="switchPanel(4)">Optimizador</div>
        </div>
    </aside>

    <main id="main-content">
        <input type="file" id="restoreInput" accept=".json" style="display:none" onchange="importBackup(this)">
        <div class="fab-container">
            <button class="fab-btn fab-draft" onclick="saveToBrowser()">üíæ Borrador</button>
            <button class="fab-btn fab-backup" onclick="exportBackup()">üì§ Backup</button>
            <button class="fab-btn fab-restore" onclick="document.getElementById('restoreInput').click()">üì• Restaurar</button>
            <button class="fab-btn fab-download" onclick="downloadSite()">üì¶ Descargar HTML</button>
        </div>

        <div id="panel-0" class="panel active">
            <h1>Bienvenido üëã</h1>
            <div id="draft-alert" class="card" style="display:none; background: #fffbeb; border: 1px solid #fcd34d;">
                <h4 style="margin:0 0 10px; color: #b45309;">‚ö†Ô∏è Borrador encontrado</h4>
                <div style="display:flex; gap:10px;">
                    <button class="btn-add-cat" style="background:#b45309; height:35px;" onclick="loadDraft()">Recuperar</button>
                    <button class="btn-add-cat" style="background:transparent; color:#b45309; border:1px solid #b45309; height:35px;" onclick="clearDraft()">Borrar</button>
                </div>
            </div>
            <div class="card">
                <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
                    <h3>üìÇ Cargar index.html (Cat√°logo)</h3>
                    <p style="margin:5px 0 0; color:#666;">Toca para subir tu p√°gina actual si quieres editarla.</p>
                    <input type="file" id="fileInput" accept=".html" style="display:none" onchange="loadFile(this)">
                </div>
                <p id="status" style="margin-top: 15px; color: var(--green); text-align: center; font-weight: 700;"></p>
                <p style="font-size:0.85rem; color:#666; text-align:center; margin-top:5px;">Si es tu primera vez, no hace falta cargar nada. Al descargar se crear√° todo nuevo.</p>
            </div>
        </div>

        <div id="panel-1" class="panel">
            <h1>Configuraci√≥n</h1>
            <div class="card">
                <div class="row">
                    <div class="col"><label>Nombre Tienda</label><input type="text" id="cfg-name"></div>
                    <div class="col"><label>WhatsApp</label><input type="tel" id="cfg-whatsapp"></div>
                </div>
                <label>Logo URL</label><input type="text" id="cfg-logo">
                <label>T√≠tulo Banner</label><input type="text" id="cfg-heroTitle">
                <label>Subt√≠tulo Banner</label><input type="text" id="cfg-heroSubtitle">
                <label>Imagen Fondo Banner</label><input type="text" id="cfg-heroImage">
                <label>Texto Despedida</label><textarea id="cfg-about"></textarea>
            </div>
            <div class="card" style="border: 1px solid #3b82f6; background: #eff6ff;">
                <h3 style="margin-top:0; color: #1e40af; font-size:1.1rem;">‚òÅÔ∏è GitHub (Subida de fotos)</h3>
                <div class="row">
                    <div class="col"><label>Usuario</label><input type="text" id="gh-user"></div>
                    <div class="col"><label>Repo</label><input type="text" id="gh-repo"></div>
                </div>
                <label>Token (Classic)</label><input type="password" id="gh-token">
                <div class="row">
                    <div class="col"><label>Carpeta (Ej: img)</label><input type="text" id="gh-folder"></div>
                    <div class="col" style="display:flex; align-items:flex-end;">
                        <button class="btn-add-cat" style="width:100%; background:#2563EB;" onclick="saveGitHubCreds()">üíæ Guardar API</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="panel-2" class="panel">
            <h1>Categor√≠as</h1>
            <div class="card">
                <div class="row">
                    <div class="col"><input type="text" id="new-cat" placeholder="Nueva categor√≠a..."></div>
                    <div style="width: auto;"><button class="btn-add-cat" onclick="addCategory()">Agregar</button></div>
                </div>
                <!-- LISTA DE CATEGOR√çAS CON EDICI√ìN -->
                <div id="cat-list" style="margin-top:20px; display:flex; flex-wrap:wrap;"></div>
            </div>
        </div>

        <div id="panel-3" class="panel">
            <h1>Art√≠culos</h1>
            <button class="btn-opt-single" style="width:100%; height:50px; font-size:1rem; margin-bottom:20px; border:2px dashed #ccc; color:var(--primary);" onclick="openProductModal()">+ Agregar Nuevo Art√≠culo</button>
            <div id="prod-list" class="prod-grid"></div>
        </div>

        <div id="panel-4" class="panel">
            <h1>Optimizador</h1>
            <div class="card">
                <div class="upload-zone" onclick="document.getElementById('opt-input').click()">
                    <h3>üì∏ Tocar para subir fotos</h3>
                    <input type="file" id="opt-input" multiple accept="image/*" style="display:none" onchange="procesarImagenes()">
                </div>
                <div style="margin-top: 15px; text-align: center;">
                    <a href="https://banana.ovo.re/" target="_blank" style="font-size: 0.85rem; color: #9ca3af; text-decoration: none; border-bottom: 1px dotted #9ca3af;">üíß Gemini Watermark Remove</a>
                </div>
                <div id="opt-grid" class="opt-grid"></div>
            </div>
        </div>
    </main>

    <div class="modal-overlay" id="product-modal">
        <div class="modal-content">
            <div class="modal-header"><h3 style="margin:0;">Detalles</h3><button style="border:none;background:none;font-size:1.5rem;cursor:pointer;" onclick="closeProductModal()">&times;</button></div>
            <div class="modal-body-grid">
                <div class="modal-form-side">
                    <input type="hidden" id="prod-id">
                    <label>Nombre</label><input type="text" id="prod-name" oninput="updatePreview()">
                    <div class="row">
                        <div class="col"><label>Categor√≠a</label><select id="prod-cat" onchange="updatePreview()"></select></div>
                        <div class="col"><label>Precio</label><input type="number" id="prod-price" oninput="updatePreview()"></div>
                    </div>
                    <label>Medidas</label><input type="text" id="prod-dims" oninput="updatePreview()">
                    <label>Foto Principal</label><input type="text" id="prod-img" oninput="updatePreview()">
                    <label>Galer√≠a Extra</label><div id="extra-img-container"></div>
                    <button type="button" class="btn-opt-single" style="margin-bottom:15px;border:1px dashed var(--primary);color:var(--primary);background:transparent;" onclick="addExtraImgField()">+ Agregar foto extra</button>
                    <label>Descripci√≥n</label><textarea id="prod-desc"></textarea>
                    <div style="margin-bottom:20px; display:flex; gap:10px; align-items:center;">
                        <input type="checkbox" id="prod-featured" style="width:auto; margin:0;"><label style="margin:0; cursor:pointer;" for="prod-featured">Destacar en Inicio</label>
                    </div>
                    <button class="btn-save-modal" onclick="saveProduct()">Guardar Cambios</button>
                </div>
                <div class="modal-preview-side">
                    <div style="margin-bottom:10px;font-weight:700;color:#999;font-size:0.8rem;">VISTA PREVIA</div>
                    <div class="preview-card">
                        <img id="prev-img" class="preview-img" src="https://via.placeholder.com/300">
                        <div class="preview-body">
                            <div id="prev-cat" class="preview-cat">CAT</div>
                            <div id="prev-name" class="preview-name">Nombre</div>
                            <div id="prev-dims" style="font-size:0.8rem;color:#888;">Medidas</div>
                            <div id="prev-price" class="preview-price">$0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const baseTemplate = `<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Muebles | Cat√°logo</title>
<meta name="description" content="Cat√°logo de muebles"><meta property="og:title" content="Muebles El Nono">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>:root{--primary:#8B5E3C;--secondary:#D4B483;--bg:#FDFBF7;--white:#FFFFFF;--text:#2C2C2C;--text-light:#666666;--accent:#E48F45;--radius:12px;--shadow:0 4px 15px rgba(139,94,60,0.08)}body.dark-mode{--primary:#D4B483;--secondary:#8B5E3C;--bg:#121212;--white:#1E1E1E;--text:#E0E0E0;--text-light:#AAAAAA;--shadow:0 4px 15px rgba(0,0,0,0.5)}*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif}body{background-color:var(--bg);color:var(--text);overflow-x:hidden;transition:.3s}body.modal-open{overflow:hidden}header{padding:15px 0;background:rgba(255,255,255,0.95);backdrop-filter:blur(5px);box-shadow:var(--shadow);position:sticky;top:0;z-index:100}body.dark-mode header{background:rgba(30,30,30,0.95)}.logo{font-family:'Playfair Display',serif;font-size:1.8rem;color:var(--primary);font-weight:700;text-align:center}.logo img{max-height:80px;margin:0 auto}.container{max-width:1200px;margin:0 auto;padding:0 15px}.hero{position:relative;height:40vh;min-height:300px;display:flex;align-items:center;justify-content:center;text-align:center;color:#fff;margin-bottom:40px;border-bottom-left-radius:30px;border-bottom-right-radius:30px;overflow:hidden}.hero-bg{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1;filter:brightness(0.6)}.hero h1{font-family:'Playfair Display',serif;font-size:2.5rem;text-shadow:0 2px 10px rgba(0,0,0,0.5)}.btn-primary{background:var(--primary);color:#fff;padding:10px 25px;border-radius:50px;font-weight:600;text-decoration:none;display:inline-block;margin-top:15px;border:none;cursor:pointer}.carousel-container{overflow-x:auto;display:flex;gap:20px;padding:10px 5px 20px 5px;scrollbar-width:none;scroll-behavior:smooth;scroll-snap-type:x mandatory}.featured-card{min-width:260px;height:350px;border-radius:16px;overflow:hidden;position:relative;box-shadow:var(--shadow);cursor:pointer;scroll-snap-align:center;flex-shrink:0}.featured-img{width:100%;height:100%;object-fit:cover}.featured-overlay{position:absolute;bottom:0;left:0;width:100%;background:linear-gradient(to top,rgba(0,0,0,0.9) 10%,transparent 100%);padding:20px;color:#fff;text-align:left}.featured-title{font-size:1.3rem;font-weight:600;margin-bottom:5px}.featured-detail{font-size:0.9rem;opacity:.8;font-weight:300}.search-wrapper{max-width:500px;margin:0 auto 30px;position:relative}.search-input{width:100%;padding:12px 20px 12px 45px;border-radius:30px;border:1px solid #ddd;outline:none;background:var(--white);color:var(--text)}.search-icon{position:absolute;left:15px;top:50%;transform:translateY(-50%);width:20px;color:#999}.filters{display:flex;justify-content:center;gap:8px;flex-wrap:wrap;margin-bottom:30px}.filter-btn{padding:6px 16px;border:1px solid var(--primary);background:transparent;color:var(--primary);border-radius:30px;font-size:0.9rem;cursor:pointer;transition:.3s}.filter-btn.active,.filter-btn:hover{background:var(--primary);color:#fff}.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:15px;margin-bottom:20px}.product-card{background:var(--white);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column;cursor:pointer;transition:transform .2s}.product-card:hover{transform:translateY(-3px)}.card-img-container{height:180px;overflow:hidden}.card-img-container img{width:100%;height:100%;object-fit:cover}.card-body{padding:12px;flex-grow:1;display:flex;flex-direction:column}.card-cat{color:var(--accent);font-size:0.7rem;font-weight:600;text-transform:uppercase}.card-title{font-size:1rem;font-weight:600;margin:4px 0;color:var(--text);line-height:1.2}.card-price{margin-top:auto;font-weight:700;color:var(--primary);font-size:1.1rem}.closing-section{padding:60px 20px;text-align:center;margin-top:50px;background:#252525;color:#fff}body.dark-mode .closing-section{background:#111}.closing-box{max-width:800px;margin:0 auto;border:2px dashed #bcaaa4;border-radius:20px;padding:40px 20px;background:rgba(255,255,255,0.05)}.shipping-badge{background:#E48F45;color:#fff;padding:12px 25px;border-radius:50px;font-weight:700;font-size:1rem;display:inline-block;margin-bottom:20px;box-shadow:0 4px 10px rgba(228,143,69,0.3);animation:pulse 2s infinite}@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}.closing-title{font-family:'Playfair Display',serif;font-size:1.8rem;color:#D4B483;margin-bottom:15px}.closing-text{color:#ccc;line-height:1.6;margin-bottom:10px;font-size:0.95rem}footer{background:#000;color:#fff;padding:50px 0;text-align:center}.btn-footer-wa{background:#25D366;color:white;border:none;padding:12px 30px;border-radius:50px;font-weight:600;font-size:1rem;cursor:pointer;display:inline-flex;align-items:center;gap:8px;margin-top:15px}.theme-toggle-btn{background:transparent;border:1px solid #666;color:#ccc;width:40px;height:40px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;margin-top:25px;transition:.3s}.theme-toggle-btn:hover{border-color:#fff;color:#fff}.theme-toggle-btn svg{width:20px;height:20px;fill:currentColor}.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:2000;display:none;align-items:center;justify-content:center;backdrop-filter:blur(5px)}.modal.open{display:flex}.modal-content{background:var(--white);width:90%;max-width:750px;height:auto;max-height:85vh;border-radius:20px;overflow:hidden;display:flex;flex-direction:column;position:relative;box-shadow:0 25px 50px -12px rgba(0,0,0,0.25)}@media(min-width:768px){.modal-content{flex-direction:row;height:500px}.modal-gallery-side{width:50%;background:#000;display:flex;align-items:center;justify-content:center}.modal-info-side{width:50%;padding:30px;overflow-y:auto;display:flex;flex-direction:column}.modal-img-main{width:100%;height:100%;object-fit:contain;cursor:zoom-in}}@media(max-width:767px){.modal-gallery-side{height:40vh;background:#f3f3f3;display:flex;align-items:center;justify-content:center;flex-shrink:0}.modal-img-main{width:100%;height:100%;object-fit:cover;cursor:zoom-in}.modal-info-side{padding:20px;overflow-y:auto;flex:1;display:flex;flex-direction:column}}.modal-close-btn{position:absolute;top:15px;right:15px;width:35px;height:35px;background:rgba(255,255,255,0.9);border-radius:50%;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:10;font-size:1.2rem}.modal-title{font-size:1.6rem;font-family:'Playfair Display',serif;margin-bottom:5px;line-height:1.1;margin-top:0}.modal-price{font-size:1.6rem;color:var(--primary);font-weight:700;margin:8px 0}.modal-tag{align-self:flex-end;background:#eee;padding:4px 12px;border-radius:20px;font-size:0.8rem;color:#666;font-weight:500;margin-bottom:5px}.modal-thumbs{display:flex;gap:8px;overflow-x:auto;padding-bottom:10px;margin-bottom:15px;flex-shrink:0;min-height:60px}.thumb-item{width:50px;height:50px;border-radius:8px;object-fit:cover;cursor:pointer;border:2px solid transparent;flex-shrink:0}.thumb-item.active{border-color:var(--primary)}.btn-wa-modal{width:100%;background:#25D366;color:white;border:none;padding:12px;border-radius:12px;font-weight:600;font-size:0.95rem;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;margin-top:auto;flex-shrink:0}.lightbox{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;z-index:3000;display:none;align-items:center;justify-content:center;cursor:zoom-out}.lightbox img{max-width:100%;max-height:100%;object-fit:contain}#name-modal .modal-content{max-width:400px;height:auto;padding:30px;text-align:center}#user-name-input{width:100%;padding:12px;border:1px solid #ccc;border-radius:8px;margin:20px 0}</style>
</head>
<body class="dark-mode">
<script type="application/json" id="site-data">{"config":{},"categories":[],"products":[]}<\/script>
<header><div class="container logo" id="header-branding">Muebles</div></header>
<section class="hero"><img src="" class="hero-bg" id="hero-img"><div class="container" style="position:relative;z-index:2"><h1 id="hero-title"></h1><p id="hero-subtitle"></p><a href="#catalogo" class="btn-primary">Ver Cat√°logo</a></div></section>
<section class="container" style="margin-bottom:40px"><h2 style="font-family:'Playfair Display';font-size:1.8rem;color:var(--primary);margin-bottom:20px">Destacados</h2><div class="carousel-container" id="featured-container"></div></section>
<section class="container" id="catalogo"><div class="search-wrapper"><svg class="search-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg><input type="text" class="search-input" placeholder="Buscar..." onkeyup="handleSearch(this.value)"></div><div class="filters" id="filters-container"></div><div class="grid" id="products-grid"></div></section>
<section class="closing-section"><div class="closing-box"><div class="shipping-badge">Hacemos env√≠os a Santiago y La Banda</div><h3 class="closing-title">¬°Gracias por tu visita!</h3><p class="closing-text" id="about-text"></p><p style="color:#E48F45;font-weight:600;margin-top:10px">¬°Te esperamos!</p></div></section>
<footer><div class="container"><p style="font-size:1.1rem;margin-bottom:20px">Consult√° precios y stock por WhatsApp</p><button class="btn-footer-wa" id="main-wa-btn"><svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.711 2.592 2.654-.696c1.001.572 1.973.911 3.033.911 3.18 0 5.767-2.587 5.767-5.766.001-3.182-2.585-5.768-5.766-5.768zm0 9.778c-1.091 0-2.126-.352-2.923-.96l-1.397.368.374-1.365c-.75-.92-1.157-1.996-1.156-3.055 0-2.213 1.8-4.013 4.012-4.013 2.21 0 4.01 1.8 4.01 4.013 0 2.214-1.799 4.013-4.01 4.013z"></path></svg>Cont√°ctanos</button><div style="margin-top:30px"><button class="theme-toggle-btn" onclick="document.body.classList.toggle('dark-mode')"><svg viewBox="0 0 24 24"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.93c.39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0l-1.41 1.41c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0l1.41-1.41zm13.42 13.42c.39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0l-1.41 1.41c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0l1.41-1.41zM5.99 19.07c-1.02-1.02-2.34-1.34-1.41 0l-1.41 1.41c-1.12 1.12.29 2.53 1.41 1.41l1.41-1.41c.39-.39.39-1.02 0-1.41zM19.07 5.99c.39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0l-1.41 1.41c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0l1.41-1.41z"/></svg></button></div><p style="font-size:0.8rem;color:#444;margin-top:20px">¬© 2026 Muebles.</p></div></footer>
<div class="modal" id="product-modal"><div class="modal-content"><button class="modal-close-btn" onclick="closeModal()">√ó</button><div class="modal-gallery-side"><img src="" class="modal-img-main" id="m-img"></div><div class="modal-info-side"><span class="modal-tag" id="m-cat">Cat</span><h2 class="modal-title" id="m-title">T√≠tulo</h2><div class="modal-price" id="m-price">$0</div><p style="margin-bottom:10px"><strong>Medidas:</strong> <span id="m-dims"></span></p><p style="color:#666;line-height:1.6;margin-bottom:20px;font-size:0.9rem" id="m-desc"></p><div class="modal-thumbs" id="m-thumbs"></div><button class="btn-wa-modal" id="m-wa"><svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.711 2.592 2.654-.696c1.001.572 1.973.911 3.033.911 3.18 0 5.767-2.587 5.767-5.766.001-3.182-2.585-5.768-5.766-5.768zm0 9.778c-1.091 0-2.126-.352-2.923-.96l-1.397.368.374-1.365c-.75-.92-1.157-1.996-1.156-3.055 0-2.213 1.8-4.013 4.012-4.013 2.21 0 4.01 1.8 4.01 4.013 0 2.214-1.799 4.013-4.01 4.013z"></path></svg>Consultar en WhatsApp</button></div></div></div><div class="lightbox" id="lightbox" onclick="this.style.display='none'"><img id="lightbox-img" src=""></div><div class="modal" id="name-modal" style="z-index:2100"><div class="modal-content" style="max-height:auto"><h3>¬°Hola! üëã</h3><p style="color:#666;margin-bottom:15px">Dinos tu nombre para iniciar el chat:</p><input type="text" id="user-name-input" placeholder="Tu nombre..."><button class="btn-primary" onclick="confirmName()" style="width:100%">Ir a WhatsApp</button></div></div>
<script>let db={};try{db=JSON.parse(document.getElementById('site-data').textContent);}catch(e){}const config=db.config||{},products=db.products||[],categories=db.categories||[];document.getElementById('header-branding').innerHTML=config.logo?("<img src='"+config.logo+"'>"):config.name;document.getElementById('hero-title').innerText=config.heroTitle;document.getElementById('hero-subtitle').innerText=config.heroSubtitle;document.getElementById('hero-img').src=config.heroImage;document.getElementById('about-text').innerText=config.aboutText;document.title=config.name;let currentCat='Todos',searchTerm='',pendingContact=null;const filtersDiv=document.getElementById('filters-container');filtersDiv.innerHTML="<button class='filter-btn active' onclick=\"filter('Todos', this)\">Todos</button>"+categories.map(c=>"<button class='filter-btn' onclick=\"filter('"+c+"', this)\">"+c+"</button>").join('');function filter(cat,btn){currentCat=cat;document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');renderGrid()}function handleSearch(val){searchTerm=val.toLowerCase();renderGrid()}function renderGrid(){const grid=document.getElementById('products-grid');grid.innerHTML='';const filtered=products.filter(p=>(currentCat==='Todos'||p.category===currentCat)&&p.name.toLowerCase().includes(searchTerm));if(filtered.length===0)grid.innerHTML='<p style=\"grid-column:1/-1;text-align:center;color:#999\">Sin resultados</p>';filtered.forEach(p=>{const c=document.createElement('article');c.className='product-card';c.onclick=()=>openModal(p.id);c.innerHTML="<div class='card-img-container'><img src='"+p.img+"' onerror=\"this.src='https://via.placeholder.com/300'\"></div><div class='card-body'><span class='card-cat'>"+p.category+"</span><h3 class='card-title'>"+p.name+"</h3>"+(p.price?("<div class='card-price'>$"+p.price+"</div>"):'')+"</div>";grid.appendChild(c)})}const feat=products.filter(p=>p.featured);const carCont=document.getElementById('featured-container');if(feat.length){carCont.innerHTML=feat.map(p=>"<div class='featured-card' onclick='openModal("+p.id+")'><img src='"+p.img+"' class='featured-img'><div class='featured-overlay'><div class='featured-title'>"+p.name+"</div><div class='featured-detail'>( Ver detalles )</div></div></div>").join('');let autoScroll=setInterval(()=>{const maxScroll=carCont.scrollWidth-carCont.clientWidth;if(carCont.scrollLeft>=maxScroll-5){carCont.scrollTo({left:0,behavior:'smooth'})}else{carCont.scrollBy({left:280,behavior:'smooth'})}},3000);carCont.addEventListener('touchstart',()=>clearInterval(autoScroll));carCont.addEventListener('touchend',()=>{clearInterval(autoScroll);autoScroll=setInterval(()=>{const maxScroll=carCont.scrollWidth-carCont.clientWidth;if(carCont.scrollLeft>=maxScroll-5){carCont.scrollTo({left:0,behavior:'smooth'})}else{carCont.scrollBy({left:280,behavior:'smooth'})}},3000)})}function openModal(id){const p=products.find(x=>x.id===id);if(!p)return;document.body.classList.add('modal-open');document.getElementById('m-img').src=p.img;document.getElementById('m-cat').innerText=p.category;document.getElementById('m-title').innerText=p.name;document.getElementById('m-dims').innerText=p.dims;document.getElementById('m-desc').innerText=p.desc;const priceEl=document.getElementById('m-price');if(p.price){priceEl.innerText="$"+p.price;priceEl.style.display='block'}else priceEl.style.display='none';const thumbsDiv=document.getElementById('m-thumbs');thumbsDiv.innerHTML='';const allImgs=[p.img].concat(p.gallery||[]);if(allImgs.length>1){thumbsDiv.style.display='flex';allImgs.forEach((src,i)=>{const img=document.createElement('img');img.src=src;img.className=i===0?'thumb-item active':'thumb-item';img.onclick=()=>{document.getElementById('m-img').src=src;document.querySelectorAll('.thumb-item').forEach(x=>x.classList.remove('active'));img.classList.add('active')};thumbsDiv.appendChild(img)})}else thumbsDiv.style.display='none';document.getElementById('m-img').onclick=()=>{document.getElementById('lightbox-img').src=document.getElementById('m-img').src;document.getElementById('lightbox').style.display='flex'};document.getElementById('m-wa').onclick=()=>openNameModal(p);document.getElementById('product-modal').classList.add('open')}function closeModal(){document.getElementById('product-modal').classList.remove('open');document.body.classList.remove('modal-open')}document.getElementById('main-wa-btn').onclick=()=>openNameModal(null);function openNameModal(p){pendingContact=p;document.getElementById('name-modal').classList.add('open');setTimeout(()=>document.getElementById('user-name-input').focus(),100)}function getArticle(name){const lower=name.toLowerCase().trim();if(lower.endsWith('a')&&!lower.endsWith('sof√°'))return 'la';return 'el'}function confirmName(){const n=document.getElementById('user-name-input').value.trim();if(!n)return alert("Por favor escribe tu nombre");let t="";if(pendingContact){const art=getArticle(pendingContact.name);t="Hola! Me llamo "+n+". Quer√≠a consultarles por "+art+" \""+pendingContact.name+"\" que vi en su p√°gina."}else{t="Hola! Me llamo "+n+". Les escribo para ponerme en contacto con ustedes y consultarles sobre los muebles que vi en su p√°gina."}window.open("https://wa.me/"+config.whatsapp+"?text="+encodeURIComponent(t),'_blank');document.getElementById('name-modal').classList.remove('open')}document.getElementById('user-name-input').onkeypress=(e)=>{if(e.key==='Enter')confirmName()};renderGrid();<\/script>
</body></html>`;

        let db={config:{},categories:[],products:[]},originalHTML="",resultadosOpt=[];
        window.onload=function(){
            if(localStorage.getItem('muebles_draft'))document.getElementById('draft-alert').style.display='block';
            ['gh_user','gh_repo','gh_token','gh_folder'].forEach(k=>{const v=localStorage.getItem(k);if(v&&document.getElementById(k.replace('_','-')))document.getElementById(k.replace('_','-')).value=v;});
        };
        function switchPanel(i){document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));document.getElementById(`panel-${i}`).classList.add('active');document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));document.querySelectorAll('.nav-item')[i].classList.add('active');}
        
        function saveGitHubCreds(){localStorage.setItem('gh_user',document.getElementById('gh-user').value.trim());localStorage.setItem('gh_repo',document.getElementById('gh-repo').value.trim());localStorage.setItem('gh_token',document.getElementById('gh-token').value.trim());localStorage.setItem('gh_folder',document.getElementById('gh-folder').value.trim());alert("Guardado.");}
        
        async function uploadToGithub(idx,btn){
            const u=localStorage.getItem('gh_user'),r=localStorage.getItem('gh_repo'),t=localStorage.getItem('gh_token');
            let f=localStorage.getItem('gh_folder')||'';
            if(!u||!r||!t)return alert("Error: Configura GitHub primero en el panel Config.");
            
            f = f.replace(/^\/+|\/+$/g, '');
            if(f) f += '/';

            // 1. PEDIR NOMBRE PERSONALIZADO
            const item=resultadosOpt[idx];
            let customName = prompt("Nombre para el archivo (sin espacios):", item.nombre.replace('.webp',''));
            if(!customName) return; 
            
            customName = customName.replace(/[^a-zA-Z0-9-_]/g, '-').toLowerCase() + '.webp';

            const old=btn.innerHTML; btn.innerHTML="‚è≥"; btn.disabled=true;
            try{
                const reader=new FileReader();
                reader.readAsDataURL(item.blob);
                reader.onloadend=async()=>{
                    const path = `${f}${customName}`;
                    const res=await fetch(`https://api.github.com/repos/${u}/${r}/contents/${path}`,{
                        method:'PUT',
                        headers:{'Authorization':`token ${t}`,'Content-Type':'application/json'},
                        body:JSON.stringify({message:`Upload ${customName}`,content:reader.result.split(',')[1]})
                    });
                    const d=await res.json();
                    if(res.ok){
                        const url = d.content.download_url;
                        const parent = btn.parentElement;
                        parent.innerHTML = `
                            <div style="width:100%">
                                <input type="text" value="${url}" readonly style="width:100%;font-size:0.8rem;border:1px solid #ddd;padding:4px;border-radius:4px;margin-bottom:2px;" onclick="this.select();document.execCommand('copy');this.style.background='#dcfce7'">
                                <div style="font-size:0.75rem;color:#059669;font-weight:bold;">‚úÖ ¬°Subido! Toca el link para copiar.</div>
                            </div>
                        `;
                    } else { throw new Error(d.message); }
                };
            }catch(e){alert("Error: "+e.message); btn.innerHTML="Error"; btn.disabled=false;}
        }

        function loadFile(inp){const r=new FileReader();r.onload=e=>{originalHTML=e.target.result;try{const doc=new DOMParser().parseFromString(originalHTML,'text/html'),sc=doc.getElementById('site-data');if(sc){db=JSON.parse(sc.textContent);if(!db.products)db.products=[];if(!db.categories)db.categories=[];document.getElementById('status').innerText="‚úÖ Cargado";refreshUI();}}catch(e){alert("Error archivo");}};r.readAsText(inp.files[0]);}
        function refreshUI(){
            document.getElementById('cfg-name').value=db.config.name||'';
            let wa=db.config.whatsapp||''; if(wa.startsWith('549'))wa=wa.substring(3); document.getElementById('cfg-whatsapp').value=wa;
            ['cfg-logo','cfg-heroTitle','cfg-heroSubtitle','cfg-heroImage','cfg-about'].forEach(id=>{document.getElementById(id).value=db.config[id.replace('cfg-','')]||'';});
            renderCats(); renderProdList();
        }
        function saveGeneral(){
            db.config.name=document.getElementById('cfg-name').value;
            let raw=document.getElementById('cfg-whatsapp').value.replace(/\D/g,''); db.config.whatsapp=raw?'549'+raw:'';
            ['logo','heroTitle','heroSubtitle','heroImage','aboutText'].forEach((k,i)=>{const ids=['cfg-logo','cfg-heroTitle','cfg-heroSubtitle','cfg-heroImage','cfg-about'];db.config[k]=document.getElementById(ids[i]).value;});
        }
        function renderCats(){document.getElementById('cat-list').innerHTML=db.categories.map((c,i)=>`<div class="cat-chip">${c} <button class="cat-btn-action cat-icon-edit" onclick="editCat(${i})" title="Editar"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button><button class="cat-btn-action cat-icon-del" onclick="if(confirm('Borrar?')){db.categories.splice(${i},1);renderCats();}" title="Borrar"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div>`).join('');}
        function addCategory(){const v=document.getElementById('new-cat').value.trim();if(v&&!db.categories.includes(v)){db.categories.push(v);document.getElementById('new-cat').value='';renderCats();}}
        
        function editCat(index) {
            const oldName = db.categories[index];
            const newName = prompt("Nuevo nombre para la categor√≠a:", oldName);
            if (newName && newName.trim() !== "" && newName !== oldName) {
                if(db.categories.includes(newName.trim())) return alert("Esa categor√≠a ya existe.");
                
                // Actualizar array de categorias
                db.categories[index] = newName.trim();
                
                // Actualizar TODOS los productos que tenian esa categoria
                let count = 0;
                db.products.forEach(p => {
                    if (p.category === oldName) {
                        p.category = newName.trim();
                        count++;
                    }
                });
                
                renderCats();
                renderProdList(); // Refrescar lista productos para ver cambio
                alert(`Categor√≠a actualizada. Se modificaron ${count} productos.`);
            }
        }

        function openProductModal(id=null){
            document.getElementById('prod-cat').innerHTML=db.categories.map(c=>`<option value="${c}">${c}</option>`).join('');
            document.getElementById('extra-img-container').innerHTML='';
            if(id!==null){
                const p=db.products.find(x=>x.id===id);
                document.getElementById('prod-id').value=p.id; document.getElementById('prod-name').value=p.name; document.getElementById('prod-cat').value=p.category;
                document.getElementById('prod-dims').value=p.dims; document.getElementById('prod-price').value=p.price; document.getElementById('prod-img').value=p.img;
                document.getElementById('prod-desc').value=p.desc; document.getElementById('prod-featured').checked=p.featured;
                if(p.gallery)p.gallery.forEach(u=>addExtraImgField(u));
            }else{
                ['prod-id','prod-name','prod-dims','prod-price','prod-img','prod-desc'].forEach(i=>document.getElementById(i).value='');
                document.getElementById('prod-featured').checked=false;
            }
            updatePreview(); document.getElementById('product-modal').classList.add('open');
        }
        function updatePreview(){
            document.getElementById('prev-name').innerText=document.getElementById('prod-name').value||'Producto';
            document.getElementById('prev-cat').innerText=document.getElementById('prod-cat').value||'CAT';
            const p=document.getElementById('prod-price').value; document.getElementById('prev-price').innerText=p?'$'+p:'';
            document.getElementById('prev-img').src=document.getElementById('prod-img').value||'https://via.placeholder.com/300';
        }
        function addExtraImgField(v=''){const d=document.createElement('div');d.className='extra-img-row';d.innerHTML=`<input type="text" class="extra-img-input" value="${v}" placeholder="URL..."><button type="button" onclick="this.parentElement.remove()" style="background:#fee2e2;border:none;color:red;border-radius:4px;">√ó</button>`;document.getElementById('extra-img-container').appendChild(d);}
        function saveProduct(){
            const id=document.getElementById('prod-id').value, g=[];
            document.querySelectorAll('.extra-img-input').forEach(i=>{if(i.value)g.push(i.value);});
            const np={id:id?parseInt(id):Date.now(),name:document.getElementById('prod-name').value,category:document.getElementById('prod-cat').value,dims:document.getElementById('prod-dims').value,price:document.getElementById('prod-price').value,img:document.getElementById('prod-img').value,gallery:g,desc:document.getElementById('prod-desc').value,featured:document.getElementById('prod-featured').checked};
            if(id){const ix=db.products.findIndex(x=>x.id==id);if(ix!==-1)db.products[ix]=np;}else db.products.push(np);
            closeProductModal();renderProdList();
        }
        function closeProductModal(){document.getElementById('product-modal').classList.remove('open');}
        function renderProdList(){document.getElementById('prod-list').innerHTML=db.products.map(p=>`<div class="prod-card"><img src="${p.img}" class="prod-img"><div class="prod-title">${p.name}</div><div class="prod-actions"><button class="btn-card btn-card-edit" onclick="openProductModal(${p.id})">Editar</button><button class="btn-card btn-card-del" onclick="if(confirm('Borrar?')){db.products=db.products.filter(x=>x.id!==${p.id});renderProdList();}">Borrar</button></div></div>`).join('');}
        
        function procesarImagenes(){
            const f=document.getElementById("opt-input").files, g=document.getElementById("opt-grid");
            if(!resultadosOpt.length)g.innerHTML="";
            [...f].forEach((file,i)=>{
                const img=new Image(), r=new FileReader();
                r.onload=e=>img.src=e.target.result; r.readAsDataURL(file);
                img.onload=()=>{
                    const max=1600; let w=img.width,h=img.height; if(w>h&&w>max){h*=max/w;w=max;}else if(h>max){w*=max/h;h=max;}
                    const c=document.createElement("canvas"); c.width=w;c.height=h; c.getContext("2d").drawImage(img,0,0,w,h);
                    c.toBlob(b=>{
                        const url=URL.createObjectURL(b), name=`img-${Date.now()}-${i}.webp`;
                        resultadosOpt.push({nombre:name,blob:b});
                        const card=document.createElement("div"); card.className="opt-card";
                        card.innerHTML=`<img src="${url}"><div style="display:flex;gap:5px;margin-top:5px;justify-content:center;"><button class="btn-opt-single" onclick="const a=document.createElement('a');a.href='${url}';a.download='${name}';a.click();">üíæ</button><button class="btn-opt-single" style="background:#eff6ff;color:#2563EB;" onclick="uploadToGithub(${resultadosOpt.length-1},this)">‚òÅÔ∏è</button></div>`;
                        g.appendChild(card);
                    },"image/webp",0.85);
                };
            });
        }
        function saveToBrowser(){saveGeneral();localStorage.setItem('muebles_draft',JSON.stringify(db));if(originalHTML)localStorage.setItem('muebles_html',originalHTML);alert("Guardado.");}
        function loadDraft(){db=JSON.parse(localStorage.getItem('muebles_draft'));if(localStorage.getItem('muebles_html'))originalHTML=localStorage.getItem('muebles_html');refreshUI();document.getElementById('draft-alert').style.display='none';}
        function clearDraft(){localStorage.removeItem('muebles_draft');document.getElementById('draft-alert').style.display='none';}
        function exportBackup(){saveGeneral();const a=document.createElement("a");a.href=URL.createObjectURL(new Blob([JSON.stringify(db,null,2)],{type:"application/json"}));a.download="backup.json";a.click();}
        function importBackup(inp){const r=new FileReader();r.onload=e=>{db=JSON.parse(e.target.result);refreshUI();};r.readAsText(inp.files[0]);}
        
        function downloadSite(){
            const sourceHTML = originalHTML || baseTemplate;
            saveGeneral(); 
            const doc=new DOMParser().parseFromString(sourceHTML,'text/html'); 
            doc.getElementById('site-data').textContent=JSON.stringify(db,null,4); 
            const a=document.createElement('a');
            a.href=URL.createObjectURL(new Blob([doc.documentElement.outerHTML],{type:"text/html"}));
            a.download="index.html";
            a.click();
        }
    </script>
</body>
</html>